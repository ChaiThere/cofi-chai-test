
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "tutorials/generated/1D_rayleigh_wave_phase_velocity_inversion.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_tutorials_generated_1D_rayleigh_wave_phase_velocity_inversion.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_tutorials_generated_1D_rayleigh_wave_phase_velocity_inversion.py:


1D Rayleigh wave phase velocity inversion
=========================================

.. GENERATED FROM PYTHON SOURCE LINES 9-14

|Open In Colab|

.. |Open In Colab| image:: https://img.shields.io/badge/open%20in-Colab-b5e2fa?logo=googlecolab&style=flat-square&color=ffd670
   :target: https://colab.research.google.com/github/inlab-geo/cofi-examples/blob/main/tutorials/rayleigh_wave_phase_velocity/1D_rayleigh_wave_phase_velocity_inversion.ipynb


.. GENERATED FROM PYTHON SOURCE LINES 17-24

If you are running this notebook locally, make sure youâ€™ve followed
`steps
here <https://github.com/inlab-geo/cofi-examples#run-the-examples-with-cofi-locally>`__
to set up the environment. (This
`environment.yml <https://github.com/inlab-geo/cofi-examples/blob/main/envs/environment.yml>`__
file specifies a list of packages required to run the notebooks)


.. GENERATED FROM PYTHON SOURCE LINES 27-43

--------------

What we do in this notebook
---------------------------

Here we look at applying CoFI to the inversion of Rayleigh wave phase
velocities for a 1D layered earth.

**Learning outcomes**

- A demonstration of CoFIâ€™s ability to switch between parameter
  estimation and ensemble methods.
- A comparison between different McMC samplers that is fixed-d and
  trans-d samplers
- An application of CoFI to field data


.. GENERATED FROM PYTHON SOURCE LINES 43-54

.. code-block:: Python


    # -------------------------------------------------------- #
    #                                                          #
    #     Uncomment below to set up environment on "colab"     #
    #                                                          #
    # -------------------------------------------------------- #

    # !pip install -U cofi git+https://github.com/inlab-geo/pysurf96.git
    # !git clone https://github.com/inlab-geo/cofi-examples.git
    # %cd cofi-examples/tutorials/rayleigh_wave_phase_velocity








.. GENERATED FROM PYTHON SOURCE LINES 56-61

.. code-block:: Python


    # If this notebook is run locally pysurf96 needs to be installed separately by uncommenting the following line, 
    # that is by removing the # and the white space between it and the exclamation mark.
    # !pip install -U cofi git+https://github.com/inlab-geo/pysurf96.git








.. GENERATED FROM PYTHON SOURCE LINES 63-73

.. code-block:: Python


    import numpy as np
    import scipy
    import matplotlib.pyplot as plt

    from pysurf96 import surf96
    import bayesbay
    import cofi









.. GENERATED FROM PYTHON SOURCE LINES 78-90

Problem description
-------------------

Here we illustrate the range of inversion methods made avaialbe by CoFI.
That is we first define a base problem and then explore the use of an
iterative non linear apporach to find the MAP solution and then employ a
range of Markov Chain Monte Carlo strategies to recover the posterior
distribution. The forward problem is solved using pysurf 96
(https://github.com/miili/pysurf96) and the field data example is taken
from (https://www.eas.slu.edu/eqc/eqc_cps/TUTORIAL/STRUCT/index.html)
and we will be inverting observed rayleigh wave phase velocities


.. GENERATED FROM PYTHON SOURCE LINES 93-95

**Inference problem**


.. GENERATED FROM PYTHON SOURCE LINES 95-104

.. code-block:: Python


    # display theory on the inference problem
    from IPython.display import display, Markdown

    with open("../../theory/geo_surface_wave_dispersion.md", "r") as f:
        content = f.read()

    display(Markdown(content))





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    <IPython.core.display.Markdown object>




.. GENERATED FROM PYTHON SOURCE LINES 109-111

**Solving methods**


.. GENERATED FROM PYTHON SOURCE LINES 111-118

.. code-block:: Python


    # display theory on the optimisation approach
    with open("../../theory/inv_optimisation.md", "r") as f:
        content = f.read()

    display(Markdown(content))





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    <IPython.core.display.Markdown object>




.. GENERATED FROM PYTHON SOURCE LINES 120-127

.. code-block:: Python


    # display theory on the optimisation approach
    with open("../../theory/inv_mcmc.md", "r") as f:
        content = f.read()

    display(Markdown(content))





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    <IPython.core.display.Markdown object>




.. GENERATED FROM PYTHON SOURCE LINES 132-136

**Further reading**

https://en.wikipedia.org/wiki/Surface_wave_inversion


.. GENERATED FROM PYTHON SOURCE LINES 139-142

Utilities
---------


.. GENERATED FROM PYTHON SOURCE LINES 145-148

1D model paramterisation
~~~~~~~~~~~~~~~~~~~~~~~~


.. GENERATED FROM PYTHON SOURCE LINES 148-155

.. code-block:: Python


    # display theory on the 1D model parameterisation
    with open("../../theory/misc_1d_model_parameterisation.md", "r") as f:
        content = f.read()

    display(Markdown(content))





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    <IPython.core.display.Markdown object>




.. GENERATED FROM PYTHON SOURCE LINES 157-170

.. code-block:: Python


    # layercake model utilities
    def form_layercake_model(thicknesses, vs):
        model = np.zeros((len(vs)*2-1,))
        model[1::2] = thicknesses
        model[::2] = vs
        return model

    def split_layercake_model(model):
        thicknesses = model[1::2]
        vs = model[::2]
        return thicknesses, vs








.. GENERATED FROM PYTHON SOURCE LINES 172-182

.. code-block:: Python


    # voronoi model utilities
    def form_voronoi_model(voronoi_sites, vs):
        return np.hstack((vs, voronoi_sites))

    def split_voronoi_model(model):
        voronoi_sites = model[len(model)//2:]
        vs = model[:len(model)//2]
        return voronoi_sites, vs








.. GENERATED FROM PYTHON SOURCE LINES 184-207

.. code-block:: Python


    def voronoi_to_layercake(voronoi_vector: np.ndarray) -> np.ndarray:
        n_layers = len(voronoi_vector) // 2
        velocities = voronoi_vector[:n_layers]
        voronoi_sites = voronoi_vector[n_layers:]
        depths = (voronoi_sites[:-1] + voronoi_sites[1:]) / 2
        thicknesses = depths - np.insert(depths[:-1], 0, 0)
        layercake_vector = np.zeros((2*n_layers-1,))
        layercake_vector[::2] = velocities
        layercake_vector[1::2] = thicknesses
        return layercake_vector

    def layercake_to_voronoi(layercake_vector: np.ndarray, first_voronoi_site: float = 0.0) -> np.ndarray:
        n_layers = len(layercake_vector) // 2 + 1
        thicknesses = layercake_vector[1::2]
        velocities = layercake_vector[::2]
        depths = np.cumsum(thicknesses)
        voronoi_sites = np.zeros((n_layers,))
        for i in range(1,len(voronoi_sites)):
            voronoi_sites[i] = 2 * depths[i-1] - voronoi_sites[i-1]
        voronoi_vector = np.hstack((velocities, voronoi_sites))
        return voronoi_vector








.. GENERATED FROM PYTHON SOURCE LINES 212-215

Forward solver
~~~~~~~~~~~~~~


.. GENERATED FROM PYTHON SOURCE LINES 215-222

.. code-block:: Python


    # display theory on the using the forward solver
    with open("../../theory/geo_surface_wave_dispersion2.md", "r") as f:
        content = f.read()

    display(Markdown(content))





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    <IPython.core.display.Markdown object>




.. GENERATED FROM PYTHON SOURCE LINES 224-230

.. code-block:: Python


    # Constants
    VP_VS = 1.77
    RHO_VP_K = 0.32
    RHO_VP_B = 0.77








.. GENERATED FROM PYTHON SOURCE LINES 232-264

.. code-block:: Python


    # forward through pysurf96
    def forward_sw(model, periods):
        thicknesses, vs = split_layercake_model(model)
        thicknesses = np.append(thicknesses, 10)
        vp = vs * VP_VS
        rho = RHO_VP_K * vp + RHO_VP_B
        return surf96(
            thicknesses,
            vp,
            vs,
            rho,
            periods,
            wave="rayleigh",
            mode=1,
            velocity="phase",
            flat_earth=False,
        )

    # numerical jacobian
    def jacobian_sw(model, periods, fwd=forward_sw, relative_step=0.01):
        jacobian = np.zeros((len(periods), len(model)))
        original_dpred = fwd(model, periods)
        for i in range(len(model)):
            perturbed_model = model.copy()
            step = relative_step * model[i]
            perturbed_model[i] += step
            perturbed_dpred = fwd(perturbed_model, periods)
            derivative = (perturbed_dpred - original_dpred) / abs(step)
            jacobian[:, i] = derivative
        return jacobian








.. GENERATED FROM PYTHON SOURCE LINES 269-276

Visualisation
-------------

For conveninece we also implement two functions to plot the data here
the Rayleigh wave phase velocity and a model given in the layer based
parametrisation.


.. GENERATED FROM PYTHON SOURCE LINES 276-301

.. code-block:: Python


    def plot_model(model, ax=None, title="model", **kwargs):
        # process data
        thicknesses = np.append(model[1::2], max(model[1::2]))
        velocities = model[::2]
        y = np.insert(np.cumsum(thicknesses), 0, 0)
        x = np.insert(velocities, 0, velocities[0])
    
        # plot depth profile
        if ax is None:
            _, ax = plt.subplots()
        plotting_style = {
            "linewidth": kwargs.pop("linewidth", kwargs.pop("lw", 0.5)),
            "alpha": 0.2,
            "color": kwargs.pop("color", kwargs.pop("c", "blue")),
        }
        plotting_style.update(kwargs)
        ax.step(x, y, where="post", **plotting_style)
        if ax.get_ylim()[0] < ax.get_ylim()[1]:
            ax.invert_yaxis()
        ax.set_xlabel("Vs (km/s)")
        ax.set_ylabel("Depth (km)")
        ax.set_title(title)
        return ax








.. GENERATED FROM PYTHON SOURCE LINES 303-323

.. code-block:: Python


    def plot_data(rayleigh_phase_velocities, periods, ax=None, scatter=False, 
                  title="data", **kwargs):
        if ax is None:
            _, ax = plt.subplots()
        plotting_style = {
            "linewidth": kwargs.pop("linewidth", kwargs.pop("lw", 1)),
            "alpha": 1,
            "color": kwargs.pop("color", kwargs.pop("c", "blue")),
        }
        plotting_style.update(**kwargs)
        if scatter:
            ax.scatter(periods, rayleigh_phase_velocities, **plotting_style)
        else:
            ax.plot(periods, rayleigh_phase_velocities, **plotting_style)
        ax.set_xlabel("Periods (s)")
        ax.set_ylabel("Rayleigh phase velocities (km/s)")
        ax.set_title(title)
        return ax








.. GENERATED FROM PYTHON SOURCE LINES 325-342

.. code-block:: Python


    def plot_model_and_data(model, label_model, color_model, 
                            forward_func, periods, label_d_pred, color_d_pred, 
                            axes=None, light_thin=False):
        if axes is None:
            _, axes = plt.subplots(1, 2, figsize=(10, 4), gridspec_kw={"width_ratios": [1, 2.5]})
        ax1, ax2 = axes
        if light_thin:
            plot_model(model, ax=ax1, color=color_model, alpha=0.2, lw=0.5, label=label_model)
            plot_data(forward_func(model, periods), periods, ax=ax2, color=color_d_pred, alpha=0.2, lw=0.5, label=label_d_pred)
        else:
            plot_model(model, ax=ax1, color=color_model, alpha=1, lw=1, label=label_model)
            plot_data(forward_func(model, periods), periods, ax=ax2, color=color_d_pred, label=label_d_pred)
        ax1.legend()
        ax2.legend()
        return ax1, ax2








.. GENERATED FROM PYTHON SOURCE LINES 347-357

Synthetic example
-----------------

Prior to inverting any field data it is good practice to test an
inversion method using sythetic exmaples where we know the true model.
It is also recommended to prior to this idnepently test any forward
solver that is being used and verify the Jacobian, as problems related
to the forward sovler are diffiuclt to identify and diagnose once they
are integrated in an inversion methodology.


.. GENERATED FROM PYTHON SOURCE LINES 360-363

Generate synthetic data
~~~~~~~~~~~~~~~~~~~~~~~


.. GENERATED FROM PYTHON SOURCE LINES 363-370

.. code-block:: Python


    synth_d_periods = np.geomspace(3, 80, 20)

    true_thicknesses = np.array([10, 10, 15, 20, 20, 20, 20, 20])
    true_vs = np.array([3.38, 3.44, 3.66, 4.25, 4.35, 4.32, 4.315, 4.38, 4.5])
    true_model = form_layercake_model(true_thicknesses, true_vs)








.. GENERATED FROM PYTHON SOURCE LINES 372-377

.. code-block:: Python


    noise_level = 0.02
    d_true = forward_sw(true_model, synth_d_periods)
    d_obs = d_true + np.random.normal(0, 0.01, len(d_true))








.. GENERATED FROM PYTHON SOURCE LINES 379-389

.. code-block:: Python


    # plot true model and d_pred from true model
    _, ax2 = plot_model_and_data(model=true_model, label_model="true model", color_model="orange",
                        forward_func=forward_sw, periods=synth_d_periods, 
                        label_d_pred="true data (noiseless)", color_d_pred="orange")

    # plot d_obs
    plot_data(d_obs, synth_d_periods, ax=ax2, scatter=True, color="red", s=20, label="observed data (noisy)")
    ax2.legend();




.. image-sg:: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_001.png
   :alt: model, data
   :srcset: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_001.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    <matplotlib.legend.Legend object at 0x7f975820b210>



.. GENERATED FROM PYTHON SOURCE LINES 394-397

Optimisation
~~~~~~~~~~~~


.. GENERATED FROM PYTHON SOURCE LINES 400-402

**Prepare ``BaseProblem`` for optimisation**


.. GENERATED FROM PYTHON SOURCE LINES 402-409

.. code-block:: Python


    n_dims = 17

    init_thicknesses = np.ones((n_dims//2,)) * 15
    init_vs = np.ones((n_dims//2+1,)) * 4.0
    init_model = form_layercake_model(init_thicknesses, init_vs)








.. GENERATED FROM PYTHON SOURCE LINES 411-426

.. code-block:: Python


    # plot the model and d_pred for starting model
    axes = plot_model_and_data(model=init_model, label_model="starting model", color_model="purple",
                               forward_func=forward_sw, periods=synth_d_periods, 
                               label_d_pred="data predictions from starting model", color_d_pred="purple")

    # plot the model and d_pred for true model
    plot_model_and_data(model=true_model, label_model="true model", color_model="orange",
                        forward_func=forward_sw, periods=synth_d_periods, 
                        label_d_pred="true data (noiseless)", color_d_pred="orange", axes=axes)

    # plot d_obs
    plot_data(d_obs, synth_d_periods, ax=axes[1], scatter=True, color="red", s=20, label="d_obs")
    axes[1].legend();




.. image-sg:: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_002.png
   :alt: model, data
   :srcset: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_002.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    <matplotlib.legend.Legend object at 0x7f975806c190>



.. GENERATED FROM PYTHON SOURCE LINES 428-435

.. code-block:: Python


    my_reg = cofi.utils.QuadraticReg(
        weighting_matrix="damping", 
        model_shape=(n_dims,), 
        reference_model=init_model
    )








.. GENERATED FROM PYTHON SOURCE LINES 437-457

.. code-block:: Python


    def my_objective(model, fwd, periods, d_obs, lamda=1.0):
        d_pred = fwd(model, periods)
        data_misfit = np.sum((d_obs - d_pred) ** 2)
        reg = my_reg(model)
        return data_misfit + lamda * reg

    def my_objective_gradient(model, fwd, periods, d_obs, lamda=1.0):
        d_pred = fwd(model, periods)
        jac = jacobian_sw(model, periods, fwd)
        data_misfit_grad = -2 * jac.T @ (d_obs - d_pred)
        reg_grad = my_reg.gradient(model)
        return data_misfit_grad + lamda * reg_grad

    def my_objective_hessian(model, fwd, periods, d_obs, lamda=1.0):
        jac = jacobian_sw(model, periods, fwd)
        data_misfit_hess = 2 * jac.T @ jac
        reg_hess = my_reg.hessian(model)
        return data_misfit_hess + lamda * reg_hess








.. GENERATED FROM PYTHON SOURCE LINES 462-465

Optimisation with no damping
^^^^^^^^^^^^^^^^^^^^^^^^^^^^


.. GENERATED FROM PYTHON SOURCE LINES 465-480

.. code-block:: Python


    lamda = 0

    kwargs = {
        "fwd": forward_sw, 
        "periods": synth_d_periods, 
        "d_obs": d_obs, 
        "lamda": lamda
    }
    sw_problem_no_reg = cofi.BaseProblem()
    sw_problem_no_reg.set_objective(my_objective, kwargs=kwargs)
    sw_problem_no_reg.set_gradient(my_objective_gradient, kwargs=kwargs)
    sw_problem_no_reg.set_hessian(my_objective_hessian, kwargs=kwargs)
    sw_problem_no_reg.set_initial_model(init_model)








.. GENERATED FROM PYTHON SOURCE LINES 485-487

**Define ``InversionOptions``**


.. GENERATED FROM PYTHON SOURCE LINES 487-492

.. code-block:: Python


    inv_options_optimiser = cofi.InversionOptions()
    inv_options_optimiser.set_tool("scipy.optimize.minimize")
    inv_options_optimiser.set_params(method="trust-exact")








.. GENERATED FROM PYTHON SOURCE LINES 497-499

**Define ``Inversion`` and run**


.. GENERATED FROM PYTHON SOURCE LINES 499-503

.. code-block:: Python


    inv_optimiser_no_reg = cofi.Inversion(sw_problem_no_reg, inv_options_optimiser)
    inv_result_optimiser_no_reg = inv_optimiser_no_reg.run()





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    /opt/miniconda3/envs/inlab/lib/python3.11/site-packages/cofi/tools/_scipy_opt_min.py:103: RuntimeWarning: Method trust-exact does not use Hessian-vector product information (hessp).
      return minimize(




.. GENERATED FROM PYTHON SOURCE LINES 508-510

**Plot results**


.. GENERATED FROM PYTHON SOURCE LINES 510-530

.. code-block:: Python


    # plot the model and d_pred for starting model
    axes = plot_model_and_data(model=init_model, label_model="starting model", color_model="black",
                               forward_func=forward_sw, periods=synth_d_periods, 
                               label_d_pred="d_pred from starting model", color_d_pred="black")

    # plot the model and d_pred for true model
    plot_model_and_data(model=true_model, label_model="true model", color_model="orange",
                        forward_func=forward_sw, periods=synth_d_periods, 
                        label_d_pred="d_pred from true model", color_d_pred="orange", axes=axes)

    # plot the model and d_pred for inverted model
    plot_model_and_data(model=inv_result_optimiser_no_reg.model, label_model="inverted model", color_model="purple",
                        forward_func=forward_sw, periods=synth_d_periods,
                        label_d_pred="d_pred from inverted model", color_d_pred="purple", axes=axes);

    # plot d_obs
    plot_data(d_obs, synth_d_periods, ax=axes[1], scatter=True, color="red", s=20, label="d_obs")
    axes[1].legend();




.. image-sg:: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_003.png
   :alt: model, data
   :srcset: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_003.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    <matplotlib.legend.Legend object at 0x7f974a196210>



.. GENERATED FROM PYTHON SOURCE LINES 535-545

Optimal damping
^^^^^^^^^^^^^^^

Obviously we get a very skewed 1D model out of an optimisation that
solely tries to minimise the data misfit. We would like to add a damping
term to our objective function, but we are not sure which factor suits
the problem well.

In this situation, the ``InversionPool`` from CoFI can be handy.


.. GENERATED FROM PYTHON SOURCE LINES 545-580

.. code-block:: Python


    lambdas = np.logspace(-6, 6, 15)

    my_lcurve_problems = []
    for lamb in lambdas:
        my_problem = cofi.BaseProblem()
        kwargs = {
            "fwd": forward_sw, 
            "periods": synth_d_periods, 
            "d_obs": d_obs, 
            "lamda": lamb
        }
        my_problem.set_objective(my_objective, kwargs=kwargs)
        my_problem.set_gradient(my_objective_gradient, kwargs=kwargs)
        my_problem.set_hessian(my_objective_hessian, kwargs=kwargs)
        my_problem.set_initial_model(init_model)
        my_lcurve_problems.append(my_problem)

    def my_callback(inv_result, i):
        m = inv_result.model
        res_norm = np.linalg.norm(forward_sw(m, synth_d_periods) - d_obs)
        reg_norm = np.sqrt(my_reg(m))
        print(f"Finished inversion with lambda={lambdas[i]}: {res_norm}, {reg_norm}")
        return res_norm, reg_norm

    my_inversion_pool = cofi.utils.InversionPool(
        list_of_inv_problems=my_lcurve_problems,
        list_of_inv_options=inv_options_optimiser,
        callback=my_callback,
        parallel=False
    )
    all_res, all_cb_returns = my_inversion_pool.run()

    l_curve_points = list(zip(*all_cb_returns))





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Finished inversion with lambda=1e-06: 0.03438423276125528, 3.121944387558622
    Finished inversion with lambda=7.196856730011514e-06: 0.03469753057291748, 2.240903225106046
    Finished inversion with lambda=5.1794746792312125e-05: 0.03535185986610418, 1.1759694577990594
    Finished inversion with lambda=0.0003727593720314938: 0.0355140980611096, 1.1245019017696656
    Finished inversion with lambda=0.0026826957952797246: 0.03584344459086738, 1.1160570098605431
    Finished inversion with lambda=0.019306977288832496: 0.04395021904049231, 1.0884125503870883
    Finished inversion with lambda=0.1389495494373136: 0.14630301919746755, 0.9586979453303422
    Finished inversion with lambda=1.0: 0.48586807759559303, 0.6494688348914328
    Finished inversion with lambda=7.196856730011514: 1.083152781891329, 0.31105745710316335
    Finished inversion with lambda=51.79474679231202: 1.6069669533391735, 0.06718905349594105
    Finished inversion with lambda=372.7593720314938: 1.7314925321224908, 0.01005348647698297
    Finished inversion with lambda=2682.6957952797275: 1.750317313281846, 0.0014111286926012298
    Finished inversion with lambda=19306.977288832455: 1.7529650596931998, 0.00019641405509302254
    Finished inversion with lambda=138949.5494373136: 1.7533392077494525, 2.729819027713892e-05
    Finished inversion with lambda=1000000.0: 1.753389738211255, 3.793197654488129e-06




.. GENERATED FROM PYTHON SOURCE LINES 582-586

.. code-block:: Python


    # print all the lambdas
    lambdas





.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    array([1.00000000e-06, 7.19685673e-06, 5.17947468e-05, 3.72759372e-04,
           2.68269580e-03, 1.93069773e-02, 1.38949549e-01, 1.00000000e+00,
           7.19685673e+00, 5.17947468e+01, 3.72759372e+02, 2.68269580e+03,
           1.93069773e+04, 1.38949549e+05, 1.00000000e+06])



.. GENERATED FROM PYTHON SOURCE LINES 591-593

**Plot L-curve**


.. GENERATED FROM PYTHON SOURCE LINES 593-602

.. code-block:: Python


    # plot the L-curve
    res_norm, reg_norm = l_curve_points
    plt.plot(reg_norm, res_norm, '.-')
    plt.xlabel(r'Norm of regularization term $||Wm||_2$')
    plt.ylabel(r'Norm of residual $||g(m)-d||_2$')
    for i in range(0, len(lambdas), 2):
        plt.annotate(f'{lambdas[i]:.1e}', (reg_norm[i], res_norm[i]), fontsize=8)




.. image-sg:: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_004.png
   :alt: 1D rayleigh wave phase velocity inversion
   :srcset: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_004.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 607-613

Optimisation with damping
^^^^^^^^^^^^^^^^^^^^^^^^^

From the L-curve plot above, it seems that a damping factor of around
0.02 would be good.


.. GENERATED FROM PYTHON SOURCE LINES 613-628

.. code-block:: Python


    lamda = 0.02

    kwargs = {
        "fwd": forward_sw, 
        "periods": synth_d_periods, 
        "d_obs": d_obs, 
        "lamda": lamda
    }
    sw_problem = cofi.BaseProblem()
    sw_problem.set_objective(my_objective, kwargs=kwargs)
    sw_problem.set_gradient(my_objective_gradient, kwargs=kwargs)
    sw_problem.set_hessian(my_objective_hessian, kwargs=kwargs)
    sw_problem.set_initial_model(init_model)








.. GENERATED FROM PYTHON SOURCE LINES 633-635

**Define ``Inversion`` and run**


.. GENERATED FROM PYTHON SOURCE LINES 635-639

.. code-block:: Python


    inv_optimiser = cofi.Inversion(sw_problem, inv_options_optimiser)
    inv_result_optimiser = inv_optimiser.run()








.. GENERATED FROM PYTHON SOURCE LINES 644-646

**Plot results**


.. GENERATED FROM PYTHON SOURCE LINES 646-666

.. code-block:: Python


    # plot the model and d_pred for starting model
    axes = plot_model_and_data(model=init_model, label_model="starting model", color_model="black",
                               forward_func=forward_sw, periods=synth_d_periods, 
                               label_d_pred="d_pred from starting model", color_d_pred="black")

    # plot the model and d_pred for true model
    plot_model_and_data(model=true_model, label_model="true model", color_model="orange",
                        forward_func=forward_sw, periods=synth_d_periods, 
                        label_d_pred="d_pred from true model", color_d_pred="orange", axes=axes)

    # plot the model and d_pred for damped solution, and d_obs
    plot_model_and_data(model=inv_result_optimiser.model, label_model="damped solution", color_model="purple",
                        forward_func=forward_sw, periods=synth_d_periods,
                        label_d_pred="d_pred from damped solution", color_d_pred="purple", axes=axes);

    # plot d_obs
    plot_data(d_obs, synth_d_periods, ax=axes[1], scatter=True, color="red", s=20, label="d_obs")
    axes[1].legend();




.. image-sg:: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_005.png
   :alt: model, data
   :srcset: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_005.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    <matplotlib.legend.Legend object at 0x7f9749f48250>



.. GENERATED FROM PYTHON SOURCE LINES 671-674

Fixed-dimensional sampling
~~~~~~~~~~~~~~~~~~~~~~~~~~


.. GENERATED FROM PYTHON SOURCE LINES 677-679

**Prepare ``BaseProblem`` for fixed-dimensional sampling**


.. GENERATED FROM PYTHON SOURCE LINES 679-694

.. code-block:: Python


    thick_min = 5
    thick_max = 30
    vs_min = 2
    vs_max = 5

    def my_log_prior(model):
        thicknesses, vs = split_layercake_model(model)
        thicknesses_out_of_bounds = (thicknesses < thick_min) | (thicknesses > thick_max)
        vs_out_of_bounds = (vs < vs_min) | (vs > vs_max)
        if np.any(thicknesses_out_of_bounds) or np.any(vs_out_of_bounds):
            return float("-inf")
        log_prior = -np.log(thick_max - thick_min) * len(thicknesses) - np.log(vs_max - vs_min) * len(vs)
        return log_prior








.. GENERATED FROM PYTHON SOURCE LINES 696-707

.. code-block:: Python


    Cdinv = np.eye(len(d_obs))/(noise_level**2)      # inverse data covariance matrix

    def my_log_likelihood(model):
        try:
            d_pred = forward_sw(model, synth_d_periods)
        except:
            return float("-inf")
        residual = d_obs - d_pred
        return -0.5 * residual @ (Cdinv @ residual).T








.. GENERATED FROM PYTHON SOURCE LINES 709-716

.. code-block:: Python


    n_walkers = 40

    my_walkers_start = np.ones((n_walkers, n_dims)) * inv_result_optimiser.model
    for i in range(n_walkers):
        my_walkers_start[i,:] += np.random.normal(0, 0.3, n_dims)








.. GENERATED FROM PYTHON SOURCE LINES 718-722

.. code-block:: Python


    sw_problem.set_log_prior(my_log_prior)
    sw_problem.set_log_likelihood(my_log_likelihood)








.. GENERATED FROM PYTHON SOURCE LINES 727-729

**Define ``InversionOptions``**


.. GENERATED FROM PYTHON SOURCE LINES 729-740

.. code-block:: Python


    inv_options_fixed_d_sampling = cofi.InversionOptions()
    inv_options_fixed_d_sampling.set_tool("emcee")
    inv_options_fixed_d_sampling.set_params(
        nwalkers=n_walkers, 
        nsteps=2_000, 
        initial_state=my_walkers_start, 
        skip_initial_state_check=True, 
        progress=True
    )








.. GENERATED FROM PYTHON SOURCE LINES 745-747

**Define ``Inversion`` and run**


.. GENERATED FROM PYTHON SOURCE LINES 750-755

We will disable the display of warnings temporarily due to the
unavoidable existence of ``-inf`` in our prior.

https://github.com/dfm/emcee/issues/370#issuecomment-1013623444


.. GENERATED FROM PYTHON SOURCE LINES 755-758

.. code-block:: Python


    np.seterr(all="ignore");





.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    {'divide': 'warn', 'over': 'warn', 'under': 'ignore', 'invalid': 'warn'}



.. GENERATED FROM PYTHON SOURCE LINES 763-766

Sample the prior
^^^^^^^^^^^^^^^^


.. GENERATED FROM PYTHON SOURCE LINES 766-773

.. code-block:: Python


    prior_sampling_problem = cofi.BaseProblem()
    prior_sampling_problem.set_log_posterior(my_log_prior)
    prior_sampling_problem.set_model_shape(init_model.shape)
    prior_sampler = cofi.Inversion(prior_sampling_problem, inv_options_fixed_d_sampling)
    prior_results = prior_sampler.run()





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

      0%|          | 0/2000 [00:00<?, ?it/s]     13%|â–ˆâ–Ž        | 263/2000 [00:00<00:00, 2622.33it/s]     26%|â–ˆâ–ˆâ–‹       | 526/2000 [00:00<00:00, 2614.43it/s]     40%|â–ˆâ–ˆâ–ˆâ–‰      | 790/2000 [00:00<00:00, 2622.38it/s]     53%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž    | 1055/2000 [00:00<00:00, 2630.78it/s]     66%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ   | 1321/2000 [00:00<00:00, 2638.53it/s]     80%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰  | 1590/2000 [00:00<00:00, 2652.67it/s]     93%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž| 1856/2000 [00:00<00:00, 2508.86it/s]    100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 2000/2000 [00:00<00:00, 2585.44it/s]




.. GENERATED FROM PYTHON SOURCE LINES 775-797

.. code-block:: Python


    import arviz as az

    labels = ["v0", "t0", "v1", "t1", "v2", "t2", "v3", "t3", "v4", "t4", "v5", "t5", "v6", "t6", "v7", "t7", "v8"]

    prior_results_sampler = prior_results.sampler
    az_idata_prior = az.from_emcee(prior_results_sampler, var_names=labels)

    axes = az.plot_trace(
        az_idata_prior, 
        backend_kwargs={"constrained_layout":True}, 
        figsize=(10,20),
    )

    for i, axes_pair in enumerate(axes):
        ax1 = axes_pair[0]
        ax2 = axes_pair[1]
        ax1.set_xlabel("parameter value")
        ax1.set_ylabel("density value")
        ax2.set_xlabel("number of iterations")
        ax2.set_ylabel("parameter value")




.. image-sg:: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_006.png
   :alt: v0, v0, t0, t0, v1, v1, t1, t1, v2, v2, t2, t2, v3, v3, t3, t3, v4, v4, t4, t4, v5, v5, t5, t5, v6, v6, t6, t6, v7, v7, t7, t7, v8, v8
   :srcset: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_006.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 802-805

Sample the posterior
^^^^^^^^^^^^^^^^^^^^


.. GENERATED FROM PYTHON SOURCE LINES 805-809

.. code-block:: Python


    inversion_fixed_d_sampler = cofi.Inversion(sw_problem, inv_options_fixed_d_sampling)
    inv_result_fixed_d_sampler = inversion_fixed_d_sampler.run()





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

      0%|          | 0/2000 [00:00<?, ?it/s]      1%|          | 12/2000 [00:00<00:17, 113.31it/s]      1%|          | 24/2000 [00:00<00:18, 109.34it/s]      2%|â–         | 35/2000 [00:00<00:17, 109.28it/s]      2%|â–         | 47/2000 [00:00<00:17, 110.53it/s]      3%|â–Ž         | 59/2000 [00:00<00:17, 112.23it/s]      4%|â–Ž         | 72/2000 [00:00<00:16, 115.09it/s]      4%|â–         | 85/2000 [00:00<00:16, 117.54it/s]      5%|â–         | 98/2000 [00:00<00:15, 120.88it/s]      6%|â–Œ         | 112/2000 [00:00<00:15, 124.36it/s]      6%|â–‹         | 126/2000 [00:01<00:14, 128.06it/s]      7%|â–‹         | 140/2000 [00:01<00:14, 130.48it/s]      8%|â–Š         | 154/2000 [00:01<00:13, 132.95it/s]      8%|â–Š         | 170/2000 [00:01<00:13, 139.04it/s]      9%|â–‰         | 185/2000 [00:01<00:12, 140.19it/s]     10%|â–ˆ         | 200/2000 [00:01<00:13, 133.84it/s]     11%|â–ˆ         | 216/2000 [00:01<00:12, 139.48it/s]     12%|â–ˆâ–        | 231/2000 [00:01<00:12, 141.52it/s]     12%|â–ˆâ–        | 247/2000 [00:01<00:11, 146.59it/s]     13%|â–ˆâ–Ž        | 262/2000 [00:01<00:11, 147.35it/s]     14%|â–ˆâ–        | 277/2000 [00:02<00:11, 147.57it/s]     15%|â–ˆâ–        | 294/2000 [00:02<00:11, 152.49it/s]     16%|â–ˆâ–Œ        | 310/2000 [00:02<00:10, 154.05it/s]     16%|â–ˆâ–‹        | 326/2000 [00:02<00:10, 153.87it/s]     17%|â–ˆâ–‹        | 342/2000 [00:02<00:10, 154.47it/s]     18%|â–ˆâ–Š        | 359/2000 [00:02<00:10, 158.86it/s]     19%|â–ˆâ–‰        | 377/2000 [00:02<00:09, 162.61it/s]     20%|â–ˆâ–‰        | 394/2000 [00:02<00:10, 160.50it/s]     21%|â–ˆâ–ˆ        | 412/2000 [00:02<00:09, 163.83it/s]     21%|â–ˆâ–ˆâ–       | 429/2000 [00:03<00:09, 164.53it/s]     22%|â–ˆâ–ˆâ–       | 446/2000 [00:03<00:09, 165.84it/s]     23%|â–ˆâ–ˆâ–Ž       | 464/2000 [00:03<00:09, 168.80it/s]     24%|â–ˆâ–ˆâ–       | 482/2000 [00:03<00:08, 170.78it/s]     25%|â–ˆâ–ˆâ–Œ       | 501/2000 [00:03<00:08, 174.05it/s]     26%|â–ˆâ–ˆâ–Œ       | 519/2000 [00:03<00:08, 171.82it/s]     27%|â–ˆâ–ˆâ–‹       | 537/2000 [00:03<00:08, 171.90it/s]     28%|â–ˆâ–ˆâ–Š       | 556/2000 [00:03<00:08, 175.22it/s]     29%|â–ˆâ–ˆâ–Š       | 574/2000 [00:03<00:08, 173.52it/s]     30%|â–ˆâ–ˆâ–‰       | 592/2000 [00:03<00:08, 174.54it/s]     30%|â–ˆâ–ˆâ–ˆ       | 610/2000 [00:04<00:08, 173.20it/s]     31%|â–ˆâ–ˆâ–ˆâ–      | 628/2000 [00:04<00:08, 169.50it/s]     32%|â–ˆâ–ˆâ–ˆâ–Ž      | 650/2000 [00:04<00:07, 183.69it/s]     34%|â–ˆâ–ˆâ–ˆâ–Ž      | 670/2000 [00:04<00:07, 187.83it/s]     35%|â–ˆâ–ˆâ–ˆâ–      | 692/2000 [00:04<00:06, 196.89it/s]     36%|â–ˆâ–ˆâ–ˆâ–Œ      | 713/2000 [00:04<00:06, 198.22it/s]     37%|â–ˆâ–ˆâ–ˆâ–‹      | 734/2000 [00:04<00:06, 198.67it/s]     38%|â–ˆâ–ˆâ–ˆâ–Š      | 755/2000 [00:04<00:06, 200.66it/s]     39%|â–ˆâ–ˆâ–ˆâ–‰      | 776/2000 [00:04<00:06, 196.40it/s]     40%|â–ˆâ–ˆâ–ˆâ–‰      | 797/2000 [00:05<00:06, 198.45it/s]     41%|â–ˆâ–ˆâ–ˆâ–ˆ      | 817/2000 [00:05<00:05, 198.05it/s]     42%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 838/2000 [00:05<00:05, 199.92it/s]     43%|â–ˆâ–ˆâ–ˆâ–ˆâ–Ž     | 859/2000 [00:05<00:05, 201.93it/s]     44%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 881/2000 [00:05<00:05, 205.36it/s]     45%|â–ˆâ–ˆâ–ˆâ–ˆâ–Œ     | 903/2000 [00:05<00:05, 206.67it/s]     46%|â–ˆâ–ˆâ–ˆâ–ˆâ–‹     | 925/2000 [00:05<00:05, 209.55it/s]     47%|â–ˆâ–ˆâ–ˆâ–ˆâ–‹     | 946/2000 [00:05<00:05, 206.56it/s]     48%|â–ˆâ–ˆâ–ˆâ–ˆâ–Š     | 968/2000 [00:05<00:04, 208.94it/s]     49%|â–ˆâ–ˆâ–ˆâ–ˆâ–‰     | 989/2000 [00:05<00:04, 208.14it/s]     50%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     | 1010/2000 [00:06<00:04, 205.45it/s]     52%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–    | 1032/2000 [00:06<00:04, 207.85it/s]     53%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž    | 1055/2000 [00:06<00:04, 213.02it/s]     54%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–    | 1077/2000 [00:06<00:04, 212.04it/s]     55%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–    | 1099/2000 [00:06<00:04, 210.21it/s]     56%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ    | 1121/2000 [00:06<00:04, 209.83it/s]     57%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹    | 1143/2000 [00:06<00:04, 211.85it/s]     58%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š    | 1165/2000 [00:06<00:03, 211.90it/s]     59%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰    | 1187/2000 [00:06<00:03, 212.52it/s]     60%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    | 1209/2000 [00:06<00:03, 212.61it/s]     62%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   | 1231/2000 [00:07<00:03, 212.01it/s]     63%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž   | 1253/2000 [00:07<00:03, 212.49it/s]     64%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   | 1275/2000 [00:07<00:03, 212.02it/s]     65%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   | 1297/2000 [00:07<00:03, 211.08it/s]     66%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ   | 1320/2000 [00:07<00:03, 214.90it/s]     67%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹   | 1342/2000 [00:07<00:03, 215.32it/s]     68%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š   | 1364/2000 [00:07<00:02, 212.98it/s]     69%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰   | 1387/2000 [00:07<00:02, 217.73it/s]     70%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   | 1409/2000 [00:07<00:02, 214.31it/s]     72%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  | 1432/2000 [00:08<00:02, 217.05it/s]     73%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž  | 1455/2000 [00:08<00:02, 220.47it/s]     74%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  | 1478/2000 [00:08<00:02, 219.63it/s]     75%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 1500/2000 [00:08<00:02, 209.19it/s]     76%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 1523/2000 [00:08<00:02, 212.74it/s]     77%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹  | 1547/2000 [00:08<00:02, 219.10it/s]     78%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š  | 1569/2000 [00:08<00:01, 217.37it/s]     80%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰  | 1593/2000 [00:08<00:01, 221.20it/s]     81%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  | 1617/2000 [00:08<00:01, 223.41it/s]     82%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– | 1640/2000 [00:08<00:01, 221.91it/s]     83%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž | 1663/2000 [00:09<00:01, 223.32it/s]     84%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– | 1686/2000 [00:09<00:01, 224.77it/s]     85%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ | 1709/2000 [00:09<00:01, 223.61it/s]     87%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹ | 1732/2000 [00:09<00:01, 223.49it/s]     88%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š | 1755/2000 [00:09<00:01, 222.42it/s]     89%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰ | 1778/2000 [00:09<00:00, 224.22it/s]     90%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ | 1801/2000 [00:09<00:00, 223.83it/s]     91%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ | 1824/2000 [00:09<00:00, 224.06it/s]     92%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–| 1847/2000 [00:09<00:00, 219.29it/s]     94%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž| 1870/2000 [00:09<00:00, 222.33it/s]     95%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–| 1893/2000 [00:10<00:00, 222.76it/s]     96%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ| 1916/2000 [00:10<00:00, 216.31it/s]     97%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹| 1938/2000 [00:10<00:00, 216.40it/s]     98%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š| 1961/2000 [00:10<00:00, 218.05it/s]     99%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰| 1983/2000 [00:10<00:00, 216.14it/s]    100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 2000/2000 [00:10<00:00, 188.84it/s]




.. GENERATED FROM PYTHON SOURCE LINES 811-815

.. code-block:: Python


    sampler = inv_result_fixed_d_sampler.sampler
    az_idata = az.from_emcee(sampler, var_names=labels)








.. GENERATED FROM PYTHON SOURCE LINES 817-820

.. code-block:: Python


    az_idata.get("posterior")






.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
    <defs>
    <symbol id="icon-database" viewBox="0 0 32 32">
    <path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
    <path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
    <path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
    </symbol>
    <symbol id="icon-file-text2" viewBox="0 0 32 32">
    <path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
    <path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    <path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    <path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    </symbol>
    </defs>
    </svg>
    <style>/* CSS stylesheet for displaying xarray objects in notebooks */

    :root {
      --xr-font-color0: var(
        --jp-content-font-color0,
        var(--pst-color-text-base rgba(0, 0, 0, 1))
      );
      --xr-font-color2: var(
        --jp-content-font-color2,
        var(--pst-color-text-base, rgba(0, 0, 0, 0.54))
      );
      --xr-font-color3: var(
        --jp-content-font-color3,
        var(--pst-color-text-base, rgba(0, 0, 0, 0.38))
      );
      --xr-border-color: var(
        --jp-border-color2,
        hsl(from var(--pst-color-on-background, white) h s calc(l - 10))
      );
      --xr-disabled-color: var(
        --jp-layout-color3,
        hsl(from var(--pst-color-on-background, white) h s calc(l - 40))
      );
      --xr-background-color: var(
        --jp-layout-color0,
        var(--pst-color-on-background, white)
      );
      --xr-background-color-row-even: var(
        --jp-layout-color1,
        hsl(from var(--pst-color-on-background, white) h s calc(l - 5))
      );
      --xr-background-color-row-odd: var(
        --jp-layout-color2,
        hsl(from var(--pst-color-on-background, white) h s calc(l - 15))
      );
    }

    html[theme="dark"],
    html[data-theme="dark"],
    body[data-theme="dark"],
    body.vscode-dark {
      --xr-font-color0: var(
        --jp-content-font-color0,
        var(--pst-color-text-base, rgba(255, 255, 255, 1))
      );
      --xr-font-color2: var(
        --jp-content-font-color2,
        var(--pst-color-text-base, rgba(255, 255, 255, 0.54))
      );
      --xr-font-color3: var(
        --jp-content-font-color3,
        var(--pst-color-text-base, rgba(255, 255, 255, 0.38))
      );
      --xr-border-color: var(
        --jp-border-color2,
        hsl(from var(--pst-color-on-background, #111111) h s calc(l + 10))
      );
      --xr-disabled-color: var(
        --jp-layout-color3,
        hsl(from var(--pst-color-on-background, #111111) h s calc(l + 40))
      );
      --xr-background-color: var(
        --jp-layout-color0,
        var(--pst-color-on-background, #111111)
      );
      --xr-background-color-row-even: var(
        --jp-layout-color1,
        hsl(from var(--pst-color-on-background, #111111) h s calc(l + 5))
      );
      --xr-background-color-row-odd: var(
        --jp-layout-color2,
        hsl(from var(--pst-color-on-background, #111111) h s calc(l + 15))
      );
    }

    .xr-wrap {
      display: block !important;
      min-width: 300px;
      max-width: 700px;
      line-height: 1.6;
    }

    .xr-text-repr-fallback {
      /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
      display: none;
    }

    .xr-header {
      padding-top: 6px;
      padding-bottom: 6px;
      margin-bottom: 4px;
      border-bottom: solid 1px var(--xr-border-color);
    }

    .xr-header > div,
    .xr-header > ul {
      display: inline;
      margin-top: 0;
      margin-bottom: 0;
    }

    .xr-obj-type,
    .xr-obj-name,
    .xr-group-name {
      margin-left: 2px;
      margin-right: 10px;
    }

    .xr-group-name::before {
      content: "ðŸ“";
      padding-right: 0.3em;
    }

    .xr-group-name,
    .xr-obj-type {
      color: var(--xr-font-color2);
    }

    .xr-sections {
      padding-left: 0 !important;
      display: grid;
      grid-template-columns: 150px auto auto 1fr 0 20px 0 20px;
      margin-block-start: 0;
      margin-block-end: 0;
    }

    .xr-section-item {
      display: contents;
    }

    .xr-section-item input {
      display: inline-block;
      opacity: 0;
      height: 0;
      margin: 0;
    }

    .xr-section-item input + label {
      color: var(--xr-disabled-color);
      border: 2px solid transparent !important;
    }

    .xr-section-item input:enabled + label {
      cursor: pointer;
      color: var(--xr-font-color2);
    }

    .xr-section-item input:focus + label {
      border: 2px solid var(--xr-font-color0) !important;
    }

    .xr-section-item input:enabled + label:hover {
      color: var(--xr-font-color0);
    }

    .xr-section-summary {
      grid-column: 1;
      color: var(--xr-font-color2);
      font-weight: 500;
    }

    .xr-section-summary > span {
      display: inline-block;
      padding-left: 0.5em;
    }

    .xr-section-summary-in:disabled + label {
      color: var(--xr-font-color2);
    }

    .xr-section-summary-in + label:before {
      display: inline-block;
      content: "â–º";
      font-size: 11px;
      width: 15px;
      text-align: center;
    }

    .xr-section-summary-in:disabled + label:before {
      color: var(--xr-disabled-color);
    }

    .xr-section-summary-in:checked + label:before {
      content: "â–¼";
    }

    .xr-section-summary-in:checked + label > span {
      display: none;
    }

    .xr-section-summary,
    .xr-section-inline-details {
      padding-top: 4px;
    }

    .xr-section-inline-details {
      grid-column: 2 / -1;
    }

    .xr-section-details {
      display: none;
      grid-column: 1 / -1;
      margin-top: 4px;
      margin-bottom: 5px;
    }

    .xr-section-summary-in:checked ~ .xr-section-details {
      display: contents;
    }

    .xr-group-box {
      display: inline-grid;
      grid-template-columns: 0px 20px auto;
      width: 100%;
    }

    .xr-group-box-vline {
      grid-column-start: 1;
      border-right: 0.2em solid;
      border-color: var(--xr-border-color);
      width: 0px;
    }

    .xr-group-box-hline {
      grid-column-start: 2;
      grid-row-start: 1;
      height: 1em;
      width: 20px;
      border-bottom: 0.2em solid;
      border-color: var(--xr-border-color);
    }

    .xr-group-box-contents {
      grid-column-start: 3;
    }

    .xr-array-wrap {
      grid-column: 1 / -1;
      display: grid;
      grid-template-columns: 20px auto;
    }

    .xr-array-wrap > label {
      grid-column: 1;
      vertical-align: top;
    }

    .xr-preview {
      color: var(--xr-font-color3);
    }

    .xr-array-preview,
    .xr-array-data {
      padding: 0 5px !important;
      grid-column: 2;
    }

    .xr-array-data,
    .xr-array-in:checked ~ .xr-array-preview {
      display: none;
    }

    .xr-array-in:checked ~ .xr-array-data,
    .xr-array-preview {
      display: inline-block;
    }

    .xr-dim-list {
      display: inline-block !important;
      list-style: none;
      padding: 0 !important;
      margin: 0;
    }

    .xr-dim-list li {
      display: inline-block;
      padding: 0;
      margin: 0;
    }

    .xr-dim-list:before {
      content: "(";
    }

    .xr-dim-list:after {
      content: ")";
    }

    .xr-dim-list li:not(:last-child):after {
      content: ",";
      padding-right: 5px;
    }

    .xr-has-index {
      font-weight: bold;
    }

    .xr-var-list,
    .xr-var-item {
      display: contents;
    }

    .xr-var-item > div,
    .xr-var-item label,
    .xr-var-item > .xr-var-name span {
      background-color: var(--xr-background-color-row-even);
      border-color: var(--xr-background-color-row-odd);
      margin-bottom: 0;
      padding-top: 2px;
    }

    .xr-var-item > .xr-var-name:hover span {
      padding-right: 5px;
    }

    .xr-var-list > li:nth-child(odd) > div,
    .xr-var-list > li:nth-child(odd) > label,
    .xr-var-list > li:nth-child(odd) > .xr-var-name span {
      background-color: var(--xr-background-color-row-odd);
      border-color: var(--xr-background-color-row-even);
    }

    .xr-var-name {
      grid-column: 1;
    }

    .xr-var-dims {
      grid-column: 2;
    }

    .xr-var-dtype {
      grid-column: 3;
      text-align: right;
      color: var(--xr-font-color2);
    }

    .xr-var-preview {
      grid-column: 4;
    }

    .xr-index-preview {
      grid-column: 2 / 5;
      color: var(--xr-font-color2);
    }

    .xr-var-name,
    .xr-var-dims,
    .xr-var-dtype,
    .xr-preview,
    .xr-attrs dt {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      padding-right: 10px;
    }

    .xr-var-name:hover,
    .xr-var-dims:hover,
    .xr-var-dtype:hover,
    .xr-attrs dt:hover {
      overflow: visible;
      width: auto;
      z-index: 1;
    }

    .xr-var-attrs,
    .xr-var-data,
    .xr-index-data {
      display: none;
      border-top: 2px dotted var(--xr-background-color);
      padding-bottom: 20px !important;
      padding-top: 10px !important;
    }

    .xr-var-attrs-in + label,
    .xr-var-data-in + label,
    .xr-index-data-in + label {
      padding: 0 1px;
    }

    .xr-var-attrs-in:checked ~ .xr-var-attrs,
    .xr-var-data-in:checked ~ .xr-var-data,
    .xr-index-data-in:checked ~ .xr-index-data {
      display: block;
    }

    .xr-var-data > table {
      float: right;
    }

    .xr-var-data > pre,
    .xr-index-data > pre,
    .xr-var-data > table > tbody > tr {
      background-color: transparent !important;
    }

    .xr-var-name span,
    .xr-var-data,
    .xr-index-name div,
    .xr-index-data,
    .xr-attrs {
      padding-left: 25px !important;
    }

    .xr-attrs,
    .xr-var-attrs,
    .xr-var-data,
    .xr-index-data {
      grid-column: 1 / -1;
    }

    dl.xr-attrs {
      padding: 0;
      margin: 0;
      display: grid;
      grid-template-columns: 125px auto;
    }

    .xr-attrs dt,
    .xr-attrs dd {
      padding: 0;
      margin: 0;
      float: left;
      padding-right: 10px;
      width: auto;
    }

    .xr-attrs dt {
      font-weight: normal;
      grid-column: 1;
    }

    .xr-attrs dt:hover span {
      display: inline-block;
      background: var(--xr-background-color);
      padding-right: 10px;
    }

    .xr-attrs dd {
      grid-column: 2;
      white-space: pre-wrap;
      word-break: break-all;
    }

    .xr-icon-database,
    .xr-icon-file-text2,
    .xr-no-icon {
      display: inline-block;
      vertical-align: middle;
      width: 1em;
      height: 1.5em !important;
      stroke-width: 0;
      stroke: currentColor;
      fill: currentColor;
    }

    .xr-var-attrs-in:checked + label > .xr-icon-file-text2,
    .xr-var-data-in:checked + label > .xr-icon-database,
    .xr-index-data-in:checked + label > .xr-icon-database {
      color: var(--xr-font-color0);
      filter: drop-shadow(1px 1px 5px var(--xr-font-color2));
      stroke-width: 0.8px;
    }
    </style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt; Size: 11MB
    Dimensions:  (chain: 40, draw: 2000)
    Coordinates:
      * chain    (chain) int64 320B 0 1 2 3 4 5 6 7 8 ... 31 32 33 34 35 36 37 38 39
      * draw     (draw) int64 16kB 0 1 2 3 4 5 6 ... 1994 1995 1996 1997 1998 1999
    Data variables: (12/17)
        v0       (chain, draw) float64 640kB 3.168 3.236 3.236 ... 3.377 3.377 3.377
        t0       (chain, draw) float64 640kB 14.71 14.72 14.72 ... 20.48 20.48 20.48
        v1       (chain, draw) float64 640kB 3.249 3.36 3.36 ... 3.802 3.802 3.802
        t1       (chain, draw) float64 640kB 14.83 14.99 14.99 ... 25.81 25.81 25.81
        v2       (chain, draw) float64 640kB 3.703 3.929 3.929 ... 4.808 4.808 4.808
        t2       (chain, draw) float64 640kB 14.65 14.78 14.78 ... 18.61 18.61 18.61
        ...       ...
        t5       (chain, draw) float64 640kB 14.49 14.68 14.68 ... 23.13 23.13 23.13
        v6       (chain, draw) float64 640kB 4.431 4.335 4.335 ... 3.251 3.251 3.251
        t6       (chain, draw) float64 640kB 15.32 15.26 15.26 ... 9.125 9.125 9.125
        v7       (chain, draw) float64 640kB 4.134 4.104 4.104 ... 4.825 4.825 4.825
        t7       (chain, draw) float64 640kB 15.23 15.17 15.17 ... 15.78 15.78 15.78
        v8       (chain, draw) float64 640kB 4.284 4.361 4.361 ... 4.677 4.677 4.677
    Attributes:
        created_at:                 2026-01-28T07:48:12.828959+00:00
        arviz_version:              0.23.1
        inference_library:          emcee
        inference_library_version:  3.1.6</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-aa5d30b3-4575-4114-ba3d-04ac54461e52' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-aa5d30b3-4575-4114-ba3d-04ac54461e52' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>chain</span>: 40</li><li><span class='xr-has-index'>draw</span>: 2000</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-6c46f777-bd2f-4188-9629-b3bdc0b05b57' class='xr-section-summary-in' type='checkbox'  checked><label for='section-6c46f777-bd2f-4188-9629-b3bdc0b05b57' class='xr-section-summary' >Coordinates: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>chain</span></div><div class='xr-var-dims'>(chain)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0 1 2 3 4 5 6 ... 34 35 36 37 38 39</div><input id='attrs-e53b35cc-8a93-45b3-a476-c9980ed9787b' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-e53b35cc-8a93-45b3-a476-c9980ed9787b' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-a8cb03ab-feae-466d-a42f-b092269c29a1' class='xr-var-data-in' type='checkbox'><label for='data-a8cb03ab-feae-466d-a42f-b092269c29a1' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17,
           18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35,
           36, 37, 38, 39])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>draw</span></div><div class='xr-var-dims'>(draw)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0 1 2 3 4 ... 1996 1997 1998 1999</div><input id='attrs-519de467-95fe-43d3-bc8b-7476a5832acc' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-519de467-95fe-43d3-bc8b-7476a5832acc' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-8dd3314a-c8fc-4548-8870-fd77c34be613' class='xr-var-data-in' type='checkbox'><label for='data-8dd3314a-c8fc-4548-8870-fd77c34be613' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([   0,    1,    2, ..., 1997, 1998, 1999])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-39af84ea-bbf6-4cb6-9b88-546c3e56437b' class='xr-section-summary-in' type='checkbox'  ><label for='section-39af84ea-bbf6-4cb6-9b88-546c3e56437b' class='xr-section-summary' >Data variables: <span>(17)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>v0</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>3.168 3.236 3.236 ... 3.377 3.377</div><input id='attrs-70c9045a-3f43-4059-b90c-f21acde956d9' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-70c9045a-3f43-4059-b90c-f21acde956d9' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-deb2ad08-b71d-4b6a-a418-913eab4ab265' class='xr-var-data-in' type='checkbox'><label for='data-deb2ad08-b71d-4b6a-a418-913eab4ab265' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[3.16823882, 3.23637491, 3.23637491, ..., 3.39005764, 3.39005764,
            3.39005764],
           [3.51380559, 3.51380559, 3.53798526, ..., 3.39393223, 3.39393223,
            3.39393223],
           [3.51546859, 3.51546859, 3.39183383, ..., 3.39758337, 3.39758337,
            3.39758337],
           ...,
           [3.70176343, 3.70176343, 3.70176343, ..., 3.40498461, 3.40498461,
            3.40498461],
           [3.31646395, 3.27273462, 3.27273462, ..., 3.39428166, 3.39528799,
            3.39572874],
           [3.35417729, 3.35417729, 3.35417729, ..., 3.37738916, 3.37738916,
            3.37738916]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>t0</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>14.71 14.72 14.72 ... 20.48 20.48</div><input id='attrs-b8db5063-b2f6-48ce-8602-58b2b1a77135' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-b8db5063-b2f6-48ce-8602-58b2b1a77135' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-b6e4c13d-536f-4fb4-a47f-b91c1c0aecb5' class='xr-var-data-in' type='checkbox'><label for='data-b6e4c13d-536f-4fb4-a47f-b91c1c0aecb5' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[14.71235812, 14.72026108, 14.72026108, ..., 20.15330058,
            20.15330058, 20.15330058],
           [15.21749022, 15.21749022, 15.16599546, ..., 21.28992412,
            21.28992412, 21.28992412],
           [14.93093265, 14.93093265, 14.71291886, ..., 20.48610652,
            20.48610652, 20.48610652],
           ...,
           [14.80710219, 14.80710219, 14.80710219, ..., 19.62932691,
            19.62932691, 19.62932691],
           [15.64532735, 15.44156336, 15.44156336, ..., 21.6403109 ,
            24.04225586, 23.99420561],
           [14.71720635, 14.71720635, 14.71720635, ..., 20.47843424,
            20.47843424, 20.47843424]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>v1</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>3.249 3.36 3.36 ... 3.802 3.802</div><input id='attrs-7d510806-510c-45fc-b9ec-f53b707e8c29' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-7d510806-510c-45fc-b9ec-f53b707e8c29' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-aeeaf9d0-d1dd-4fa8-bed1-fab1df96a0dd' class='xr-var-data-in' type='checkbox'><label for='data-aeeaf9d0-d1dd-4fa8-bed1-fab1df96a0dd' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[3.24901228, 3.35988483, 3.35988483, ..., 3.78269234, 3.78269234,
            3.78269234],
           [3.18150866, 3.18150866, 3.40632039, ..., 3.80163748, 3.80163748,
            3.80163748],
           [3.91758382, 3.91758382, 3.76105819, ..., 3.81025822, 3.81025822,
            3.81025822],
           ...,
           [3.35567374, 3.35567374, 3.35567374, ..., 3.58682516, 3.58682516,
            3.58682516],
           [4.07695943, 3.93620828, 3.93620828, ..., 3.89465052, 3.96995041,
            3.96890136],
           [3.87774001, 3.87774001, 3.87774001, ..., 3.80159168, 3.80159168,
            3.80159168]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>t1</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>14.83 14.99 14.99 ... 25.81 25.81</div><input id='attrs-8920ee69-bf34-44ea-a9b5-ca1088c4741b' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-8920ee69-bf34-44ea-a9b5-ca1088c4741b' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-2be3ce03-c213-4353-913a-7c1937735e29' class='xr-var-data-in' type='checkbox'><label for='data-2be3ce03-c213-4353-913a-7c1937735e29' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[14.82915776, 14.98978163, 14.98978163, ..., 17.89249152,
            17.89249152, 17.89249152],
           [15.21662766, 15.21662766, 15.1520897 , ..., 17.29106265,
            17.29106265, 17.29106265],
           [14.79886694, 14.79886694, 15.02328879, ..., 22.74617067,
            22.74617067, 22.74617067],
           ...,
           [15.08613999, 15.08613999, 15.08613999, ...,  7.46270248,
             7.46270248,  7.46270248],
           [15.02212239, 15.14350157, 15.14350157, ..., 25.37032927,
            28.79394393, 28.25662867],
           [15.04047099, 15.04047099, 15.04047099, ..., 25.81265096,
            25.81265096, 25.81265096]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>v2</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>3.703 3.929 3.929 ... 4.808 4.808</div><input id='attrs-0143b6a1-1339-4e75-bc13-bc17a84d0c23' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-0143b6a1-1339-4e75-bc13-bc17a84d0c23' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-bef80f7b-d4f1-4596-aba9-7a4297306911' class='xr-var-data-in' type='checkbox'><label for='data-bef80f7b-d4f1-4596-aba9-7a4297306911' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[3.70256992, 3.92868813, 3.92868813, ..., 4.3235598 , 4.3235598 ,
            4.3235598 ],
           [3.9856111 , 3.9856111 , 4.03228762, ..., 4.07234106, 4.07234106,
            4.07234106],
           [3.8556995 , 3.8556995 , 3.87038703, ..., 4.30096952, 4.30096952,
            4.30096952],
           ...,
           [3.8004415 , 3.8004415 , 3.8004415 , ..., 3.88471865, 3.88471865,
            3.88471865],
           [3.98196574, 3.98441188, 3.98441188, ..., 4.44897651, 4.75648536,
            4.72450726],
           [4.04843326, 4.04843326, 4.04843326, ..., 4.80752011, 4.80752011,
            4.80752011]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>t2</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>14.65 14.78 14.78 ... 18.61 18.61</div><input id='attrs-fb7ecb1e-2da9-4919-86ab-10be7809277a' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-fb7ecb1e-2da9-4919-86ab-10be7809277a' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-996924c2-3250-45e6-bcae-472853b66fa6' class='xr-var-data-in' type='checkbox'><label for='data-996924c2-3250-45e6-bcae-472853b66fa6' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[14.65282913, 14.78013278, 14.78013278, ..., 29.53259212,
            29.53259212, 29.53259212],
           [15.24375452, 15.24375452, 15.12224471, ...,  7.53111899,
             7.53111899,  7.53111899],
           [15.23396022, 15.23396022, 15.28257882, ..., 14.0119226 ,
            14.0119226 , 14.0119226 ],
           ...,
           [14.75293969, 14.75293969, 14.75293969, ..., 11.36352928,
            11.36352928, 11.36352928],
           [15.23608366, 15.24427472, 15.24427472, ...,  6.14535299,
             5.84450419,  6.86036769],
           [15.03072778, 15.03072778, 15.03072778, ..., 18.60976747,
            18.60976747, 18.60976747]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>v3</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>4.195 4.157 4.157 ... 4.693 4.693</div><input id='attrs-c41b6af3-6fa3-4d9e-a6ef-88f5370df595' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-c41b6af3-6fa3-4d9e-a6ef-88f5370df595' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-dadb9efc-fe66-40b1-a6a3-97fbf6cb3f75' class='xr-var-data-in' type='checkbox'><label for='data-dadb9efc-fe66-40b1-a6a3-97fbf6cb3f75' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[4.19489946, 4.15745776, 4.15745776, ..., 4.47221281, 4.47221281,
            4.47221281],
           [4.12325215, 4.12325215, 4.19655582, ..., 4.56422701, 4.56422701,
            4.56422701],
           [4.67849791, 4.67849791, 4.59586966, ..., 4.99508225, 4.99508225,
            4.99508225],
           ...,
           [4.2900744 , 4.2900744 , 4.2900744 , ..., 4.53049265, 4.53049265,
            4.53049265],
           [4.43271874, 4.2234137 , 4.2234137 , ..., 4.81539001, 4.80522361,
            4.78637288],
           [4.51816805, 4.51816805, 4.51816805, ..., 4.69298844, 4.69298844,
            4.69298844]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>t3</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>15.05 15.08 15.08 ... 10.01 10.01</div><input id='attrs-7fd397c7-5aae-4124-b51f-23757d7b2b33' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-7fd397c7-5aae-4124-b51f-23757d7b2b33' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-df6e0d0b-33f6-404f-ae59-14c3c0d26345' class='xr-var-data-in' type='checkbox'><label for='data-df6e0d0b-33f6-404f-ae59-14c3c0d26345' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[15.04782773, 15.08198559, 15.08198559, ...,  8.56906546,
             8.56906546,  8.56906546],
           [15.20479825, 15.20479825, 15.14596469, ..., 11.65170057,
            11.65170057, 11.65170057],
           [15.39594684, 15.39594684, 15.24103019, ...,  5.75152589,
             5.75152589,  5.75152589],
           ...,
           [14.95327287, 14.95327287, 14.95327287, ...,  5.9440371 ,
             5.9440371 ,  5.9440371 ],
           [14.91734983, 14.83264557, 14.83264557, ..., 17.57555636,
            18.84861046, 18.27280934],
           [14.99271104, 14.99271104, 14.99271104, ..., 10.00867943,
            10.00867943, 10.00867943]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>v4</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>3.592 3.836 3.836 ... 3.907 3.907</div><input id='attrs-54227c69-de67-4a1f-b63b-6ed5e7132467' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-54227c69-de67-4a1f-b63b-6ed5e7132467' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-f328209c-9c02-4c39-bf9a-73a22320242f' class='xr-var-data-in' type='checkbox'><label for='data-f328209c-9c02-4c39-bf9a-73a22320242f' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[3.5918633 , 3.83607156, 3.83607156, ..., 4.05007981, 4.05007981,
            4.05007981],
           [4.24745208, 4.24745208, 4.30181315, ..., 4.26787039, 4.26787039,
            4.26787039],
           [4.49257314, 4.49257314, 4.40495979, ..., 4.44569536, 4.44569536,
            4.44569536],
           ...,
           [4.30891342, 4.30891342, 4.30891342, ..., 4.13746373, 4.13746373,
            4.13746373],
           [4.18560628, 4.09183002, 4.09183002, ..., 3.89281767, 3.89522623,
            3.93420598],
           [4.25682369, 4.25682369, 4.25682369, ..., 3.90686204, 3.90686204,
            3.90686204]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>t4</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>15.28 15.17 15.17 ... 19.11 19.11</div><input id='attrs-ef9d33e3-7834-4e8c-8684-ef972aa86210' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-ef9d33e3-7834-4e8c-8684-ef972aa86210' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-06e4cb5c-0c9c-470f-bce3-aefad327fe3e' class='xr-var-data-in' type='checkbox'><label for='data-06e4cb5c-0c9c-470f-bce3-aefad327fe3e' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[15.28129464, 15.1709943 , 15.1709943 , ..., 26.11444878,
            26.11444878, 26.11444878],
           [15.24094659, 15.24094659, 15.17584084, ..., 21.3974503 ,
            21.3974503 , 21.3974503 ],
           [14.66482403, 14.66482403, 14.6873594 , ..., 13.42064334,
            13.42064334, 13.42064334],
           ...,
           [14.89931027, 14.89931027, 14.89931027, ..., 25.89994662,
            25.89994662, 25.89994662],
           [15.49546403, 15.41013798, 15.41013798, ..., 18.92517138,
            19.9590086 , 20.4148828 ],
           [14.89398444, 14.89398444, 14.89398444, ..., 19.11352435,
            19.11352435, 19.11352435]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>v5</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>4.254 4.234 4.234 ... 4.809 4.809</div><input id='attrs-3ed68a1e-8bd1-4b34-8247-556a00902d04' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-3ed68a1e-8bd1-4b34-8247-556a00902d04' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-d9fdb9c7-13a4-4519-b460-416f50d6ecc8' class='xr-var-data-in' type='checkbox'><label for='data-d9fdb9c7-13a4-4519-b460-416f50d6ecc8' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[4.25447122, 4.23402978, 4.23402978, ..., 4.68571302, 4.68571302,
            4.68571302],
           [4.60285613, 4.60285613, 4.54805573, ..., 4.27115944, 4.27115944,
            4.27115944],
           [4.34239961, 4.34239961, 4.18443056, ..., 3.80172475, 3.80172475,
            3.80172475],
           ...,
           [4.0856875 , 4.0856875 , 4.0856875 , ..., 4.78086602, 4.78086602,
            4.78086602],
           [4.31120687, 4.33565248, 4.33565248, ..., 4.57954393, 4.4971877 ,
            4.5066945 ],
           [4.01114754, 4.01114754, 4.01114754, ..., 4.80913075, 4.80913075,
            4.80913075]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>t5</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>14.49 14.68 14.68 ... 23.13 23.13</div><input id='attrs-a4a940a0-adb4-4628-ae83-88ed34434724' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-a4a940a0-adb4-4628-ae83-88ed34434724' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-889fca1e-3054-44be-af6c-2f4d0735fa8d' class='xr-var-data-in' type='checkbox'><label for='data-889fca1e-3054-44be-af6c-2f4d0735fa8d' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[14.49135341, 14.67907735, 14.67907735, ..., 29.79139232,
            29.79139232, 29.79139232],
           [15.30879822, 15.30879822, 15.18641008, ..., 17.91339289,
            17.91339289, 17.91339289],
           [14.74669571, 14.74669571, 14.7458424 , ..., 14.96012381,
            14.96012381, 14.96012381],
           ...,
           [14.96780374, 14.96780374, 14.96780374, ..., 19.23502005,
            19.23502005, 19.23502005],
           [15.04283659, 15.01661614, 15.01661614, ..., 11.72510338,
            10.94035648, 11.57934385],
           [14.95254179, 14.95254179, 14.95254179, ..., 23.13338315,
            23.13338315, 23.13338315]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>v6</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>4.431 4.335 4.335 ... 3.251 3.251</div><input id='attrs-eba3cfc5-39dc-4f23-afe6-ba07cc79f670' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-eba3cfc5-39dc-4f23-afe6-ba07cc79f670' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-a60ef205-d69c-4a0c-afa0-8039c9965341' class='xr-var-data-in' type='checkbox'><label for='data-a60ef205-d69c-4a0c-afa0-8039c9965341' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[4.43072008, 4.33502552, 4.33502552, ..., 4.66598604, 4.66598604,
            4.66598604],
           [4.39164238, 4.39164238, 4.41450414, ..., 4.21220869, 4.21220869,
            4.21220869],
           [4.19547832, 4.19547832, 4.15772727, ..., 4.41179236, 4.41179236,
            4.41179236],
           ...,
           [4.45149896, 4.45149896, 4.45149896, ..., 3.96077922, 3.96077922,
            3.96077922],
           [3.9344087 , 4.0247334 , 4.0247334 , ..., 4.6571492 , 4.6033366 ,
            4.53672465],
           [4.22741751, 4.22741751, 4.22741751, ..., 3.25061496, 3.25061496,
            3.25061496]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>t6</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>15.32 15.26 15.26 ... 9.125 9.125</div><input id='attrs-294582c9-fcbe-4024-806f-fcb3cc85c2b0' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-294582c9-fcbe-4024-806f-fcb3cc85c2b0' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-35a73786-0a33-4488-b5a3-d98712ee2ad9' class='xr-var-data-in' type='checkbox'><label for='data-35a73786-0a33-4488-b5a3-d98712ee2ad9' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[15.31831816, 15.25502392, 15.25502392, ..., 22.8443281 ,
            22.8443281 , 22.8443281 ],
           [14.82366736, 14.82366736, 14.73019061, ...,  7.4411747 ,
             7.4411747 ,  7.4411747 ],
           [14.91983958, 14.91983958, 14.8384564 , ...,  7.17601309,
             7.17601309,  7.17601309],
           ...,
           [15.23171528, 15.23171528, 15.23171528, ..., 28.64359931,
            28.64359931, 28.64359931],
           [14.82168512, 14.87847368, 14.87847368, ..., 19.66427724,
            20.00638563, 19.92756928],
           [14.67033646, 14.67033646, 14.67033646, ...,  9.12455804,
             9.12455804,  9.12455804]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>v7</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>4.134 4.104 4.104 ... 4.825 4.825</div><input id='attrs-f9f0d39b-5d7d-4f7b-a5a8-e8d651beebe0' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-f9f0d39b-5d7d-4f7b-a5a8-e8d651beebe0' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-dc495991-b71d-42a3-b3b9-41d8ae6dd3ad' class='xr-var-data-in' type='checkbox'><label for='data-dc495991-b71d-42a3-b3b9-41d8ae6dd3ad' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[4.13398961, 4.10411724, 4.10411724, ..., 3.4843882 , 3.4843882 ,
            3.4843882 ],
           [4.4032643 , 4.4032643 , 4.21630331, ..., 4.37239042, 4.37239042,
            4.37239042],
           [4.1889069 , 4.1889069 , 4.01408391, ..., 4.94379564, 4.94379564,
            4.94379564],
           ...,
           [4.06878258, 4.06878258, 4.06878258, ..., 4.94740173, 4.94740173,
            4.94740173],
           [4.20514672, 4.23210389, 4.23210389, ..., 3.88351945, 3.96546506,
            3.96532537],
           [4.13159942, 4.13159942, 4.13159942, ..., 4.82521657, 4.82521657,
            4.82521657]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>t7</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>15.23 15.17 15.17 ... 15.78 15.78</div><input id='attrs-a727f30c-67fa-461d-a9ed-13f0c642247e' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-a727f30c-67fa-461d-a9ed-13f0c642247e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-58441e05-973e-4933-864c-0a6bdb0bad49' class='xr-var-data-in' type='checkbox'><label for='data-58441e05-973e-4933-864c-0a6bdb0bad49' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[15.22649565, 15.16957437, 15.16957437, ..., 12.90627353,
            12.90627353, 12.90627353],
           [14.34184078, 14.34184078, 14.47598123, ..., 21.7312287 ,
            21.7312287 , 21.7312287 ],
           [14.47058303, 14.47058303, 14.54816073, ..., 14.66925224,
            14.66925224, 14.66925224],
           ...,
           [15.27280225, 15.27280225, 15.27280225, ..., 16.43597684,
            16.43597684, 16.43597684],
           [14.88033396, 14.92205908, 14.92205908, ..., 22.91332568,
            23.20341062, 22.47517285],
           [15.06308061, 15.06308061, 15.06308061, ..., 15.78315173,
            15.78315173, 15.78315173]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>v8</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>4.284 4.361 4.361 ... 4.677 4.677</div><input id='attrs-277b9d8e-2fee-40b8-8688-b2cde83e45f2' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-277b9d8e-2fee-40b8-8688-b2cde83e45f2' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-0b65d0f2-d9f1-4cc0-8cd4-5dd00f23430c' class='xr-var-data-in' type='checkbox'><label for='data-0b65d0f2-d9f1-4cc0-8cd4-5dd00f23430c' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[4.28417593, 4.36062259, 4.36062259, ..., 4.57159724, 4.57159724,
            4.57159724],
           [4.46387865, 4.46387865, 4.49341151, ..., 4.45162818, 4.45162818,
            4.45162818],
           [4.31668296, 4.31668296, 4.45305792, ..., 4.45968138, 4.45968138,
            4.45968138],
           ...,
           [4.55044997, 4.55044997, 4.55044997, ..., 4.48810698, 4.48810698,
            4.48810698],
           [4.60937652, 4.57232696, 4.57232696, ..., 4.71218878, 4.72172384,
            4.73057195],
           [4.86414945, 4.86414945, 4.86414945, ..., 4.67685294, 4.67685294,
            4.67685294]])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-b02eeb16-3c32-4571-84b5-57b216f46b15' class='xr-section-summary-in' type='checkbox'  checked><label for='section-b02eeb16-3c32-4571-84b5-57b216f46b15' class='xr-section-summary' >Attributes: <span>(4)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>created_at :</span></dt><dd>2026-01-28T07:48:12.828959+00:00</dd><dt><span>arviz_version :</span></dt><dd>0.23.1</dd><dt><span>inference_library :</span></dt><dd>emcee</dd><dt><span>inference_library_version :</span></dt><dd>3.1.6</dd></dl></div></li></ul></div></div>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 822-856

.. code-block:: Python


    # plot the model and d_pred for starting model
    axes = plot_model_and_data(model=init_model, label_model="initial model for damped solution", color_model="black",
                               forward_func=forward_sw, periods=synth_d_periods, 
                               label_d_pred="d_pred from initial model for damped solution", color_d_pred="black")

    # plot the model and d_pred for true model
    plot_model_and_data(model=true_model, label_model="true model", color_model="orange",
                        forward_func=forward_sw, periods=synth_d_periods, 
                        label_d_pred="d_pred from true model", color_d_pred="orange", axes=axes)

    # plot the model and d_pred for damped solution, and d_obs
    plot_model_and_data(model=inv_result_optimiser.model, label_model="damped solution", color_model="green",
                        forward_func=forward_sw, periods=synth_d_periods,
                        label_d_pred="d_pred from damped solution", color_d_pred="green", axes=axes);

    # plot randomly selected samples and data predictions from samples
    flat_samples = sampler.get_chain(discard=500, thin=500, flat=True)
    rand_indices = np.random.randint(len(flat_samples), size=100)
    for idx in rand_indices:
        sample = flat_samples[idx]
        label_model = "sample models" if idx == 0 else None
        label_d_pred = "d_pred from samples" if idx == 0 else None
        plot_model_and_data(model=sample, label_model=label_model, color_model="gray",
                            forward_func=forward_sw, periods=synth_d_periods,
                            label_d_pred=label_d_pred, color_d_pred="gray", axes=axes, light_thin=True)

    # plot d_obs
    plot_data(d_obs, synth_d_periods, ax=axes[1], scatter=True, color="red", s=20, label="d_obs")

    axes[0].set_ylim(170)
    axes[0].legend(loc="lower center", bbox_to_anchor=(0.5, -0.46))
    axes[1].legend(loc="lower center", bbox_to_anchor=(0.5, -0.46));




.. image-sg:: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_007.png
   :alt: model, data
   :srcset: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_007.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    <matplotlib.legend.Legend object at 0x7f9749f24b10>



.. GENERATED FROM PYTHON SOURCE LINES 858-874

.. code-block:: Python


    axes = az.plot_trace(
        az_idata, 
        backend_kwargs={"constrained_layout":True},
        figsize=(10,20)
    )

    for i, axes_pair in enumerate(axes):
        ax1 = axes_pair[0]
        ax2 = axes_pair[1]
        ax1.axvline(true_model[i], linestyle='dotted', color='red')
        ax1.set_xlabel("parameter value")
        ax1.set_ylabel("density value")
        ax2.set_xlabel("number of iterations")
        ax2.set_ylabel("parameter value")




.. image-sg:: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_008.png
   :alt: v0, v0, t0, t0, v1, v1, t1, t1, v2, v2, t2, t2, v3, v3, t3, t3, v4, v4, t4, t4, v5, v5, t5, t5, v6, v6, t6, t6, v7, v7, t7, t7, v8, v8
   :srcset: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_008.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 879-894

**More steps?**

Due to time restrictions, we have only run 2_000 steps above, which
might be enough for illustration purpose and sanity check, but are not
enough for an actual inversion.

On a seperate experiment, we ran 200_000 steps instead and produced the
following samples plot.

.. figure::
   https://raw.githubusercontent.com/inlab-geo/cofi-examples/main/tutorials/rayleigh_wave_phase_velocity/illustrations/emcee_200_000_iterations.png?raw=true
   :alt: Fixed-dimensional sampling results with 200_000 steps

   Fixed-dimensional sampling results with 200_000 steps


.. GENERATED FROM PYTHON SOURCE LINES 897-900

Trans-dimensional sampling
~~~~~~~~~~~~~~~~~~~~~~~~~~


.. GENERATED FROM PYTHON SOURCE LINES 903-905

**Prepare utilities for trans-dimensional sampling**


.. GENERATED FROM PYTHON SOURCE LINES 905-914

.. code-block:: Python


    def forward_for_bayesbay(state):
        vs = state["voronoi"]["vs"]
        voronoi_sites = state["voronoi"]["discretization"]
        depths = (voronoi_sites[:-1] + voronoi_sites[1:]) / 2
        thicknesses = depths - np.insert(depths[:-1], 0, 0)
        model = form_layercake_model(thicknesses, vs)
        return forward_sw(model, synth_d_periods)








.. GENERATED FROM PYTHON SOURCE LINES 916-921

.. code-block:: Python


    targets = [bayesbay.likelihood.Target("rayleigh", d_obs, covariance_mat_inv=1/noise_level**2)]
    fwd_funcs = [forward_for_bayesbay]
    my_log_likelihood = bayesbay.likelihood.LogLikelihood(targets, fwd_funcs) 








.. GENERATED FROM PYTHON SOURCE LINES 923-946

.. code-block:: Python


    param_vs = bayesbay.prior.UniformPrior(
        name="vs", 
        vmin=[2.7, 3.2, 3.75], 
        vmax=[4, 4.75, 5], 
        position=[0, 40, 80], 
        perturb_std=0.15
    )

    def param_vs_initialize(param, positions): 
        vmin, vmax = param.get_vmin_vmax(positions)
        sorted_vals = np.sort(np.random.uniform(vmin, vmax, positions.size))
        for i in range (len(sorted_vals)):
            val = sorted_vals[i]
            vmin_i = vmin if np.isscalar(vmin) else vmin[i]
            vmax_i = vmax if np.isscalar(vmax) else vmax[i]
            if val < vmin_i or val > vmax_i:
                if val > vmax_i: sorted_vals[i] = vmax_i
                if val < vmin_i: sorted_vals[i] = vmin_i
        return sorted_vals

    param_vs.set_custom_initialize(param_vs_initialize)








.. GENERATED FROM PYTHON SOURCE LINES 948-963

.. code-block:: Python


    parameterization = bayesbay.parameterization.Parameterization(
        bayesbay.discretization.Voronoi1D(
            name="voronoi", 
            vmin=0, 
            vmax=150, 
            perturb_std=10, 
            n_dimensions=None, 
            n_dimensions_min=4, 
            n_dimensions_max=15, 
            parameters=[param_vs], 
        )
    )
    my_perturbation_funcs=parameterization.perturbation_funcs








.. GENERATED FROM PYTHON SOURCE LINES 965-971

.. code-block:: Python


    n_chains=12
    walkers_start = []
    for i in range(n_chains):
        walkers_start.append(parameterization.initialize())








.. GENERATED FROM PYTHON SOURCE LINES 976-978

**Define ``InversionOptions``**


.. GENERATED FROM PYTHON SOURCE LINES 978-992

.. code-block:: Python


    inv_options_trans_d_sampling = cofi.InversionOptions()
    inv_options_trans_d_sampling.set_tool("bayesbay")
    inv_options_trans_d_sampling.set_params(
        walkers_starting_states=walkers_start,
        perturbation_funcs=my_perturbation_funcs,
        log_like_ratio_func=my_log_likelihood,
        n_chains=n_chains, 
        n_iterations=3_000, 
        burnin_iterations=1_000,
        verbose=False, 
        save_every=200, 
    )








.. GENERATED FROM PYTHON SOURCE LINES 997-999

**Define ``Inversion`` and run**


.. GENERATED FROM PYTHON SOURCE LINES 999-1003

.. code-block:: Python


    inversion_trans_d_sampler = cofi.Inversion(sw_problem, inv_options_trans_d_sampling)
    inv_result_trans_d_sampler = inversion_trans_d_sampler.run()








.. GENERATED FROM PYTHON SOURCE LINES 1005-1012

.. code-block:: Python


    inverted_models = inv_result_trans_d_sampler.models
    samples = []
    for v, vs in zip(inverted_models["voronoi.discretization"], inverted_models["voronoi.vs"]):
        sample = form_voronoi_model(v, vs)
        samples.append(voronoi_to_layercake(sample))








.. GENERATED FROM PYTHON SOURCE LINES 1014-1045

.. code-block:: Python


    # plot the model and d_pred for starting model
    axes = plot_model_and_data(model=init_model, label_model="initial model for damped solution", color_model="black",
                               forward_func=forward_sw, periods=synth_d_periods, 
                               label_d_pred="d_pred from initial model for damped solution", color_d_pred="black")

    # plot the model and d_pred for true model
    plot_model_and_data(model=true_model, label_model="true model", color_model="orange",
                        forward_func=forward_sw, periods=synth_d_periods, 
                        label_d_pred="d_pred from true model", color_d_pred="orange", axes=axes)

    # plot the model and d_pred for damped solution, and d_obs
    plot_model_and_data(model=inv_result_optimiser.model, label_model="damped solution", color_model="green",
                        forward_func=forward_sw, periods=synth_d_periods,
                        label_d_pred="d_pred from damped solution", color_d_pred="green", axes=axes);

    # plot randomly selected samples and data predictions from samples
    for i, sample in enumerate(samples):
        label_model = "sample models" if i == 0 else None
        label_d_pred = "d_pred from samples" if i == 0 else None
        plot_model_and_data(model=sample, label_model=label_model, color_model="gray",
                            forward_func=forward_sw, periods=synth_d_periods,
                            label_d_pred=label_d_pred, color_d_pred="gray", axes=axes, light_thin=True)

    # plot d_obs
    plot_data(d_obs, synth_d_periods, ax=axes[1], scatter=True, color="red", s=20, label="d_obs")

    axes[0].set_ylim(170)
    axes[0].legend(loc="lower center", bbox_to_anchor=(0.5, -0.46))
    axes[1].legend(loc="lower center", bbox_to_anchor=(0.5, -0.46));




.. image-sg:: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_009.png
   :alt: model, data
   :srcset: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_009.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    <matplotlib.legend.Legend object at 0x7f972cb0d490>



.. GENERATED FROM PYTHON SOURCE LINES 1050-1053

Field data example
------------------


.. GENERATED FROM PYTHON SOURCE LINES 1056-1059

Read data
~~~~~~~~~


.. GENERATED FROM PYTHON SOURCE LINES 1062-1064

**Rayleigh observations**


.. GENERATED FROM PYTHON SOURCE LINES 1064-1079

.. code-block:: Python


    file_surf_data = "../../data/sw_rf_joint/data/SURF/nnall.dsp"

    with open(file_surf_data, "r") as file:
        lines = file.readlines()
        surf_data = []
        for line in lines:
            row = line.strip().split()
            if "C" in row:
                surf_data.append([float(e) for e in row[5:8]])

    field_d = np.array(surf_data)
    field_d_periods = field_d[:,0]
    field_d_obs = field_d[:,1]








.. GENERATED FROM PYTHON SOURCE LINES 1081-1086

.. code-block:: Python


    ax = plot_data(field_d_obs, field_d_periods, color="brown", s=5, scatter=True,
                 label="d_obs")
    ax.legend();




.. image-sg:: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_010.png
   :alt: data
   :srcset: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_010.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    <matplotlib.legend.Legend object at 0x7f972ca7f2d0>



.. GENERATED FROM PYTHON SOURCE LINES 1091-1093

**Reference good model**


.. GENERATED FROM PYTHON SOURCE LINES 1093-1106

.. code-block:: Python


    file_end_mod = "../../data/sw_rf_joint/data/SURF/end.mod"

    with open(file_end_mod, "r") as file:
        lines = file.readlines()
        ref_good_model = []
        for line in lines[12:]:
            row = line.strip().split()
            ref_good_model.append([float(row[0]), float(row[2])])

    ref_good_model = np.array(ref_good_model)
    ref_good_model = form_layercake_model(ref_good_model[:-1,0], ref_good_model[:,1])








.. GENERATED FROM PYTHON SOURCE LINES 1108-1112

.. code-block:: Python


    _, ax = plt.subplots(figsize=(4,6))
    plot_model(ref_good_model, ax=ax, alpha=1);




.. image-sg:: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_011.png
   :alt: model
   :srcset: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_011.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    <Axes: title={'center': 'model'}, xlabel='Vs (km/s)', ylabel='Depth (km)'>



.. GENERATED FROM PYTHON SOURCE LINES 1117-1120

Modified forward utility
~~~~~~~~~~~~~~~~~~~~~~~~


.. GENERATED FROM PYTHON SOURCE LINES 1120-1135

.. code-block:: Python


    def forward_sw_interp(model, periods=field_d_periods):
        pysurf_periods = np.logspace(
            np.log(np.min(periods)), 
            np.log(np.max(periods+1)), 
            60,
            base=np.e, 
        )
        pysurf_dpred = forward_sw(model, pysurf_periods)
        interp_func = scipy.interpolate.interp1d(pysurf_periods, 
                                                 pysurf_dpred, 
                                                 fill_value="extrapolate")
        dpred = interp_func(periods)
        return dpred








.. GENERATED FROM PYTHON SOURCE LINES 1140-1143

Optimisation
~~~~~~~~~~~~


.. GENERATED FROM PYTHON SOURCE LINES 1143-1150

.. code-block:: Python


    n_dims = 29

    init_thicknesses = np.ones((n_dims//2,)) * 10
    init_vs = np.ones((n_dims//2+1,)) * 4.0
    init_model = form_layercake_model(init_thicknesses, init_vs)








.. GENERATED FROM PYTHON SOURCE LINES 1152-1159

.. code-block:: Python


    my_reg = cofi.utils.QuadraticReg(
        weighting_matrix="damping", 
        model_shape=(n_dims,), 
        reference_model=init_model
    )








.. GENERATED FROM PYTHON SOURCE LINES 1164-1167

Optimisation with no damping
^^^^^^^^^^^^^^^^^^^^^^^^^^^^


.. GENERATED FROM PYTHON SOURCE LINES 1167-1182

.. code-block:: Python


    lamda = 0

    kwargs = {
        "fwd": forward_sw_interp,
        "periods": field_d_periods, 
        "d_obs": field_d_obs, 
        "lamda": lamda, 
    }
    sw_field_problem_no_reg = cofi.BaseProblem()
    sw_field_problem_no_reg.set_objective(my_objective, kwargs=kwargs)
    sw_field_problem_no_reg.set_gradient(my_objective_gradient, kwargs=kwargs)
    sw_field_problem_no_reg.set_hessian(my_objective_hessian, kwargs=kwargs)
    sw_field_problem_no_reg.set_initial_model(init_model)








.. GENERATED FROM PYTHON SOURCE LINES 1187-1189

**Define ``Inversion`` and run**


.. GENERATED FROM PYTHON SOURCE LINES 1189-1193

.. code-block:: Python


    inv_sw_field_problem_no_reg = cofi.Inversion(sw_field_problem_no_reg, inv_options_optimiser)
    inv_result_sw_field_no_reg = inv_sw_field_problem_no_reg.run()





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    /opt/miniconda3/envs/inlab/lib/python3.11/site-packages/cofi/tools/_scipy_opt_min.py:103: RuntimeWarning: Method trust-exact does not use Hessian-vector product information (hessp).
      return minimize(




.. GENERATED FROM PYTHON SOURCE LINES 1198-1200

**Plot results**


.. GENERATED FROM PYTHON SOURCE LINES 1200-1208

.. code-block:: Python


    field_d_periods_logspace = np.logspace(
        np.log(np.min(field_d_periods)), 
        np.log(np.max(field_d_periods+1)), 
        60, 
        base=np.e, 
    )








.. GENERATED FROM PYTHON SOURCE LINES 1210-1234

.. code-block:: Python


    # plot the model and d_pred for starting model
    axes = plot_model_and_data(model=init_model, label_model="starting model", color_model="black",
                               forward_func=forward_sw_interp, periods=field_d_periods_logspace, 
                               label_d_pred="d_pred from starting model", color_d_pred="black")

    # plot the model and d_pred for true model
    plot_model_and_data(model=ref_good_model, label_model="reference good model", color_model="red",
                        forward_func=forward_sw_interp, periods=field_d_periods_logspace, 
                        label_d_pred="d_pred from reference good model", color_d_pred="red", axes=axes)

    # plot the model and d_pred for inverted model, and d_obs
    plot_model_and_data(model=inv_result_sw_field_no_reg.model, 
                        label_model="inverted model from field data", color_model="purple",
                        forward_func=forward_sw_interp, periods=field_d_periods_logspace,
                        label_d_pred="d_pred from inverted model", color_d_pred="purple", axes=axes)

    # plot d_obs
    plot_data(field_d_obs, field_d_periods, ax=axes[1], scatter=True, color="orange", s=8, label="d_obs")

    axes[0].set_ylim(100, 0)
    axes[0].legend(loc="lower center", bbox_to_anchor=(0.5, -0.4))
    axes[1].legend(loc="lower center", bbox_to_anchor=(0.5, -0.46));




.. image-sg:: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_012.png
   :alt: model, data
   :srcset: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_012.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    <matplotlib.legend.Legend object at 0x7f972c6d0e50>



.. GENERATED FROM PYTHON SOURCE LINES 1239-1244

Optimal damping
^^^^^^^^^^^^^^^

Again, we would like to find a good regularisation factor.


.. GENERATED FROM PYTHON SOURCE LINES 1244-1279

.. code-block:: Python


    lambdas = np.logspace(-6, 6, 15)

    my_lcurve_problems = []
    for lamb in lambdas:
        my_problem = cofi.BaseProblem()
        kwargs = {
            "fwd": forward_sw_interp,
            "periods": field_d_periods, 
            "d_obs": field_d_obs, 
            "lamda": lamb, 
        }
        my_problem.set_objective(my_objective, kwargs=kwargs)
        my_problem.set_gradient(my_objective_gradient, kwargs=kwargs)
        my_problem.set_hessian(my_objective_hessian, kwargs=kwargs)
        my_problem.set_initial_model(init_model)
        my_lcurve_problems.append(my_problem)

    def my_callback(inv_result, i):
        m = inv_result.model
        res_norm = np.linalg.norm(forward_sw_interp(m, field_d_periods) - field_d_obs)
        reg_norm = np.sqrt(my_reg(m))
        print(f"Finished inversion with lambda={lambdas[i]}: {res_norm}, {reg_norm}")
        return res_norm, reg_norm

    my_inversion_pool = cofi.utils.InversionPool(
        list_of_inv_problems=my_lcurve_problems,
        list_of_inv_options=inv_options_optimiser,
        callback=my_callback,
        parallel=False
    )
    all_res, all_cb_returns = my_inversion_pool.run()

    l_curve_points = list(zip(*all_cb_returns))





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Finished inversion with lambda=1e-06: 1.985114475403252, 4.004926607991924
    Finished inversion with lambda=7.196856730011514e-06: 1.9856165431508779, 3.9687874809730515
    Finished inversion with lambda=5.1794746792312125e-05: 1.9847536060678685, 4.0521388550036646
    Finished inversion with lambda=0.0003727593720314938: 1.985206668613372, 3.972886091484976
    Finished inversion with lambda=0.0026826957952797246: 1.9844143859178365, 3.934305769591028
    Finished inversion with lambda=0.019306977288832496: 2.0050487589831296, 2.3444829711502004
    Finished inversion with lambda=0.1389495494373136: 2.0393075600400765, 1.6477196400618848
    Finished inversion with lambda=1.0: 2.1129352066202585, 1.3870389626598725
    Finished inversion with lambda=7.196856730011514: 2.7878709628525176, 0.9907596195990267
    Finished inversion with lambda=51.79474679231202: 4.890121206314141, 0.34475341704573875
    Finished inversion with lambda=372.7593720314938: 5.957317958789923, 0.06130040191481636
    Finished inversion with lambda=2682.6957952797275: 6.160090401090757, 0.008874082501172824
    Finished inversion with lambda=19306.977288832455: 6.189746332507266, 0.0012405710283712814
    Finished inversion with lambda=138949.5494373136: 6.193898396141414, 0.00017252347237342765
    Finished inversion with lambda=1000000.0: 6.194456571037781, 2.3974367261401122e-05




.. GENERATED FROM PYTHON SOURCE LINES 1281-1285

.. code-block:: Python


    # print all the lambdas
    lambdas





.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    array([1.00000000e-06, 7.19685673e-06, 5.17947468e-05, 3.72759372e-04,
           2.68269580e-03, 1.93069773e-02, 1.38949549e-01, 1.00000000e+00,
           7.19685673e+00, 5.17947468e+01, 3.72759372e+02, 2.68269580e+03,
           1.93069773e+04, 1.38949549e+05, 1.00000000e+06])



.. GENERATED FROM PYTHON SOURCE LINES 1287-1296

.. code-block:: Python


    # plot the L-curve
    res_norm, reg_norm = l_curve_points
    plt.plot(reg_norm, res_norm, '.-')
    plt.xlabel(r'Norm of regularization term $||Wm||_2$')
    plt.ylabel(r'Norm of residual $||g(m)-d||_2$')
    for i in range(0, len(lambdas), 2):
        plt.annotate(f'{lambdas[i]:.1e}', (reg_norm[i], res_norm[i]), fontsize=8)




.. image-sg:: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_013.png
   :alt: 1D rayleigh wave phase velocity inversion
   :srcset: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_013.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 1301-1304

Optimisation with damping
^^^^^^^^^^^^^^^^^^^^^^^^^


.. GENERATED FROM PYTHON SOURCE LINES 1304-1319

.. code-block:: Python


    lamda = 0.14

    kwargs = {
        "fwd": forward_sw_interp,
        "periods": field_d_periods, 
        "d_obs": field_d_obs, 
        "lamda": lamda, 
    }
    sw_field_problem = cofi.BaseProblem()
    sw_field_problem.set_objective(my_objective, kwargs=kwargs)
    sw_field_problem.set_gradient(my_objective_gradient, kwargs=kwargs)
    sw_field_problem.set_hessian(my_objective_hessian, kwargs=kwargs)
    sw_field_problem.set_initial_model(init_model)








.. GENERATED FROM PYTHON SOURCE LINES 1324-1326

**Define ``Inversion`` and run**


.. GENERATED FROM PYTHON SOURCE LINES 1326-1330

.. code-block:: Python


    inv_sw_field_problem = cofi.Inversion(sw_field_problem, inv_options_optimiser)
    inv_result_sw_field = inv_sw_field_problem.run()








.. GENERATED FROM PYTHON SOURCE LINES 1335-1337

**Plot results**


.. GENERATED FROM PYTHON SOURCE LINES 1337-1361

.. code-block:: Python


    # plot the model and d_pred for starting model
    axes = plot_model_and_data(model=init_model, label_model="starting model", color_model="black",
                               forward_func=forward_sw_interp, periods=field_d_periods_logspace, 
                               label_d_pred="d_pred from starting model", color_d_pred="black")

    # plot the model and d_pred for true model
    plot_model_and_data(model=ref_good_model, label_model="reference good model", color_model="red",
                        forward_func=forward_sw_interp, periods=field_d_periods_logspace, 
                        label_d_pred="d_pred from reference good model", color_d_pred="red", axes=axes)

    # plot the model and d_pred for inverted model, and d_obs
    plot_model_and_data(model=inv_result_sw_field.model, 
                        label_model="inverted model from field data", color_model="purple",
                        forward_func=forward_sw_interp, periods=field_d_periods_logspace,
                        label_d_pred="d_pred from inverted model", color_d_pred="purple", axes=axes)

    # plot d_obs
    plot_data(field_d_obs, field_d_periods, ax=axes[1], scatter=True, color="orange", s=8, label="d_obs")

    axes[0].set_ylim(100, 0)
    axes[0].legend(loc="lower center", bbox_to_anchor=(0.5, -0.4))
    axes[1].legend(loc="lower center", bbox_to_anchor=(0.5, -0.46));




.. image-sg:: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_014.png
   :alt: model, data
   :srcset: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_014.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    <matplotlib.legend.Legend object at 0x7f972c876250>



.. GENERATED FROM PYTHON SOURCE LINES 1366-1372

Fixed-dimensional sampling
~~~~~~~~~~~~~~~~~~~~~~~~~~

We are going to use the same sets of log prior, and we will rewrite the
log likelihood function to apply on the field data.


.. GENERATED FROM PYTHON SOURCE LINES 1372-1388

.. code-block:: Python


    thick_min = 3
    thick_max = 10
    vs_min = 2
    vs_max = 5.5

    def my_log_prior(model):
        thicknesses, vs = split_layercake_model(model)
        thicknesses_out_of_bounds = (thicknesses < thick_min) | (thicknesses > thick_max)
        vs_out_of_bounds = (vs < vs_min) | (vs > vs_max)
        if np.any(thicknesses_out_of_bounds) or np.any(vs_out_of_bounds):
            return float("-inf")
        log_prior = - np.log(thick_max - thick_min) * len(thicknesses) \
                    - np.log(vs_max - vs_min) * len(vs)
        return log_prior








.. GENERATED FROM PYTHON SOURCE LINES 1390-1398

.. code-block:: Python


    # estimate the data noise
    d_pred_from_optimiser = forward_sw_interp(inv_result_sw_field.model, field_d_periods)
    noise_level = np.std(field_d_obs - d_pred_from_optimiser)
    Cdinv = np.eye(len(field_d_obs))/(noise_level**2)

    print(f"Estimated noise level: {noise_level}")





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Estimated noise level: 0.10587819642203654




.. GENERATED FROM PYTHON SOURCE LINES 1400-1409

.. code-block:: Python


    def my_log_likelihood(model):
        try:
            d_pred = forward_sw_interp(model, field_d_periods)
        except:
            return float("-inf")
        residual = field_d_obs - d_pred
        return -0.5 * residual @ (Cdinv @ residual).T








.. GENERATED FROM PYTHON SOURCE LINES 1411-1418

.. code-block:: Python


    n_walkers = 60

    my_walkers_start = np.ones((n_walkers, n_dims)) * inv_result_sw_field.model
    for i in range(n_walkers):
        my_walkers_start[i,:] += np.random.normal(0, 0.3, n_dims)








.. GENERATED FROM PYTHON SOURCE LINES 1420-1424

.. code-block:: Python


    sw_field_problem.set_log_prior(my_log_prior)
    sw_field_problem.set_log_likelihood(my_log_likelihood)








.. GENERATED FROM PYTHON SOURCE LINES 1429-1431

**Define ``InversionOptions``**


.. GENERATED FROM PYTHON SOURCE LINES 1431-1442

.. code-block:: Python


    inv_options_fixed_d_sampling = cofi.InversionOptions()
    inv_options_fixed_d_sampling.set_tool("emcee")
    inv_options_fixed_d_sampling.set_params(
        nwalkers=n_walkers,
        nsteps=20_000,
        initial_state=my_walkers_start,
        skip_initial_state_check=True,
        progress=True
    )








.. GENERATED FROM PYTHON SOURCE LINES 1447-1450

Sample the posterior
^^^^^^^^^^^^^^^^^^^^


.. GENERATED FROM PYTHON SOURCE LINES 1450-1455

.. code-block:: Python


    inversion_fixed_d_sampler_field = cofi.Inversion(sw_field_problem,
                                                     inv_options_fixed_d_sampling)
    inv_result_fixed_d_sampler_field = inversion_fixed_d_sampler_field.run()





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

      0%|          | 0/20000 [00:00<?, ?it/s]      1%|          | 211/20000 [00:00<00:09, 2109.95it/s]      2%|â–         | 422/20000 [00:00<00:09, 2109.59it/s]      3%|â–Ž         | 633/20000 [00:00<00:09, 2103.41it/s]      4%|â–         | 844/20000 [00:00<00:09, 2105.75it/s]      5%|â–Œ         | 1055/20000 [00:00<00:09, 2089.23it/s]      6%|â–‹         | 1267/20000 [00:00<00:08, 2096.93it/s]      7%|â–‹         | 1477/20000 [00:00<00:08, 2086.70it/s]      8%|â–Š         | 1689/20000 [00:00<00:08, 2096.79it/s]      9%|â–‰         | 1899/20000 [00:00<00:08, 2086.83it/s]     11%|â–ˆ         | 2111/20000 [00:01<00:08, 2096.40it/s]     12%|â–ˆâ–        | 2321/20000 [00:01<00:08, 1988.88it/s]     13%|â–ˆâ–Ž        | 2533/20000 [00:01<00:08, 2025.79it/s]     14%|â–ˆâ–Ž        | 2745/20000 [00:01<00:08, 2051.44it/s]     15%|â–ˆâ–        | 2956/20000 [00:01<00:08, 2068.66it/s]     16%|â–ˆâ–Œ        | 3168/20000 [00:01<00:08, 2074.64it/s]     17%|â–ˆâ–‹        | 3376/20000 [00:01<00:08, 2029.50it/s]     18%|â–ˆâ–Š        | 3595/20000 [00:01<00:07, 2074.65it/s]     19%|â–ˆâ–‰        | 3813/20000 [00:01<00:07, 2104.37it/s]     20%|â–ˆâ–ˆ        | 4031/20000 [00:01<00:07, 2125.35it/s]     21%|â–ˆâ–ˆ        | 4249/20000 [00:02<00:07, 2140.66it/s]     22%|â–ˆâ–ˆâ–       | 4467/20000 [00:02<00:07, 2150.57it/s]     23%|â–ˆâ–ˆâ–Ž       | 4685/20000 [00:02<00:07, 2157.18it/s]     25%|â–ˆâ–ˆâ–       | 4901/20000 [00:02<00:06, 2157.85it/s]     26%|â–ˆâ–ˆâ–Œ       | 5119/20000 [00:02<00:06, 2162.47it/s]     27%|â–ˆâ–ˆâ–‹       | 5336/20000 [00:02<00:06, 2147.31it/s]     28%|â–ˆâ–ˆâ–Š       | 5554/20000 [00:02<00:06, 2155.96it/s]     29%|â–ˆâ–ˆâ–‰       | 5772/20000 [00:02<00:06, 2161.30it/s]     30%|â–ˆâ–ˆâ–‰       | 5989/20000 [00:02<00:06, 2148.95it/s]     31%|â–ˆâ–ˆâ–ˆ       | 6207/20000 [00:02<00:06, 2156.62it/s]     32%|â–ˆâ–ˆâ–ˆâ–      | 6425/20000 [00:03<00:06, 2161.67it/s]     33%|â–ˆâ–ˆâ–ˆâ–Ž      | 6642/20000 [00:03<00:06, 2149.50it/s]     34%|â–ˆâ–ˆâ–ˆâ–      | 6860/20000 [00:03<00:06, 2156.02it/s]     35%|â–ˆâ–ˆâ–ˆâ–Œ      | 7078/20000 [00:03<00:05, 2160.46it/s]     36%|â–ˆâ–ˆâ–ˆâ–‹      | 7295/20000 [00:03<00:05, 2148.28it/s]     38%|â–ˆâ–ˆâ–ˆâ–Š      | 7513/20000 [00:03<00:05, 2156.32it/s]     39%|â–ˆâ–ˆâ–ˆâ–Š      | 7731/20000 [00:03<00:05, 2160.65it/s]     40%|â–ˆâ–ˆâ–ˆâ–‰      | 7948/20000 [00:03<00:05, 2147.99it/s]     41%|â–ˆâ–ˆâ–ˆâ–ˆ      | 8166/20000 [00:03<00:05, 2156.51it/s]     42%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 8382/20000 [00:03<00:05, 2141.19it/s]     43%|â–ˆâ–ˆâ–ˆâ–ˆâ–Ž     | 8600/20000 [00:04<00:05, 2151.97it/s]     44%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 8818/20000 [00:04<00:05, 2159.27it/s]     45%|â–ˆâ–ˆâ–ˆâ–ˆâ–Œ     | 9034/20000 [00:04<00:05, 2145.79it/s]     46%|â–ˆâ–ˆâ–ˆâ–ˆâ–‹     | 9251/20000 [00:04<00:04, 2152.77it/s]     47%|â–ˆâ–ˆâ–ˆâ–ˆâ–‹     | 9469/20000 [00:04<00:04, 2159.41it/s]     48%|â–ˆâ–ˆâ–ˆâ–ˆâ–Š     | 9685/20000 [00:04<00:04, 2112.08it/s]     50%|â–ˆâ–ˆâ–ˆâ–ˆâ–‰     | 9902/20000 [00:04<00:04, 2128.96it/s]     51%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     | 10119/20000 [00:04<00:04, 2140.96it/s]     52%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–    | 10337/20000 [00:04<00:04, 2149.91it/s]     53%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž    | 10555/20000 [00:04<00:04, 2156.58it/s]     54%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–    | 10771/20000 [00:05<00:04, 2145.61it/s]     55%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–    | 10989/20000 [00:05<00:04, 2154.12it/s]     56%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ    | 11207/20000 [00:05<00:04, 2161.04it/s]     57%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹    | 11424/20000 [00:05<00:03, 2148.95it/s]     58%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š    | 11642/20000 [00:05<00:03, 2157.05it/s]     59%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰    | 11860/20000 [00:05<00:03, 2162.62it/s]     60%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    | 12077/20000 [00:05<00:03, 2142.63it/s]     61%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   | 12295/20000 [00:05<00:03, 2151.26it/s]     63%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž   | 12513/20000 [00:05<00:03, 2158.44it/s]     64%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž   | 12729/20000 [00:05<00:03, 2145.93it/s]     65%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   | 12947/20000 [00:06<00:03, 2153.68it/s]     66%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ   | 13164/20000 [00:06<00:03, 2158.33it/s]     67%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹   | 13380/20000 [00:06<00:03, 2146.55it/s]     68%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š   | 13597/20000 [00:06<00:02, 2152.19it/s]     69%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰   | 13815/20000 [00:06<00:02, 2157.53it/s]     70%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   | 14031/20000 [00:06<00:02, 2144.92it/s]     71%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   | 14249/20000 [00:06<00:02, 2153.27it/s]     72%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  | 14467/20000 [00:06<00:02, 2160.53it/s]     73%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž  | 14684/20000 [00:06<00:02, 2148.95it/s]     75%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  | 14902/20000 [00:06<00:02, 2155.27it/s]     76%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 15120/20000 [00:07<00:02, 2160.80it/s]     77%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹  | 15337/20000 [00:07<00:02, 2148.65it/s]     78%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š  | 15555/20000 [00:07<00:02, 2155.49it/s]     79%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰  | 15773/20000 [00:07<00:01, 2161.93it/s]     80%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰  | 15990/20000 [00:07<00:01, 2149.82it/s]     81%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  | 16208/20000 [00:07<00:01, 2158.26it/s]     82%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– | 16426/20000 [00:07<00:01, 2163.09it/s]     83%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž | 16643/20000 [00:07<00:01, 2149.23it/s]     84%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– | 16861/20000 [00:07<00:01, 2157.36it/s]     85%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ | 17079/20000 [00:07<00:01, 2162.79it/s]     86%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹ | 17296/20000 [00:08<00:01, 2116.79it/s]     88%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š | 17514/20000 [00:08<00:01, 2133.95it/s]     89%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š | 17731/20000 [00:08<00:01, 2142.41it/s]     90%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰ | 17949/20000 [00:08<00:00, 2151.91it/s]     91%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ | 18167/20000 [00:08<00:00, 2159.61it/s]     92%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–| 18384/20000 [00:08<00:00, 2148.27it/s]     93%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž| 18602/20000 [00:08<00:00, 2156.63it/s]     94%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–| 18820/20000 [00:08<00:00, 2161.87it/s]     95%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ| 19037/20000 [00:08<00:00, 2148.52it/s]     96%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹| 19255/20000 [00:09<00:00, 2155.92it/s]     97%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹| 19473/20000 [00:09<00:00, 2160.90it/s]     98%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š| 19690/20000 [00:09<00:00, 2145.46it/s]    100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰| 19908/20000 [00:09<00:00, 2155.22it/s]    100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 20000/20000 [00:09<00:00, 2138.47it/s]




.. GENERATED FROM PYTHON SOURCE LINES 1457-1461

.. code-block:: Python


    sampler = inv_result_fixed_d_sampler.sampler
    az_idata = az.from_emcee(sampler, var_names=labels)








.. GENERATED FROM PYTHON SOURCE LINES 1463-1466

.. code-block:: Python


    az_idata.get("posterior")






.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
    <defs>
    <symbol id="icon-database" viewBox="0 0 32 32">
    <path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
    <path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
    <path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
    </symbol>
    <symbol id="icon-file-text2" viewBox="0 0 32 32">
    <path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
    <path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    <path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    <path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
    </symbol>
    </defs>
    </svg>
    <style>/* CSS stylesheet for displaying xarray objects in notebooks */

    :root {
      --xr-font-color0: var(
        --jp-content-font-color0,
        var(--pst-color-text-base rgba(0, 0, 0, 1))
      );
      --xr-font-color2: var(
        --jp-content-font-color2,
        var(--pst-color-text-base, rgba(0, 0, 0, 0.54))
      );
      --xr-font-color3: var(
        --jp-content-font-color3,
        var(--pst-color-text-base, rgba(0, 0, 0, 0.38))
      );
      --xr-border-color: var(
        --jp-border-color2,
        hsl(from var(--pst-color-on-background, white) h s calc(l - 10))
      );
      --xr-disabled-color: var(
        --jp-layout-color3,
        hsl(from var(--pst-color-on-background, white) h s calc(l - 40))
      );
      --xr-background-color: var(
        --jp-layout-color0,
        var(--pst-color-on-background, white)
      );
      --xr-background-color-row-even: var(
        --jp-layout-color1,
        hsl(from var(--pst-color-on-background, white) h s calc(l - 5))
      );
      --xr-background-color-row-odd: var(
        --jp-layout-color2,
        hsl(from var(--pst-color-on-background, white) h s calc(l - 15))
      );
    }

    html[theme="dark"],
    html[data-theme="dark"],
    body[data-theme="dark"],
    body.vscode-dark {
      --xr-font-color0: var(
        --jp-content-font-color0,
        var(--pst-color-text-base, rgba(255, 255, 255, 1))
      );
      --xr-font-color2: var(
        --jp-content-font-color2,
        var(--pst-color-text-base, rgba(255, 255, 255, 0.54))
      );
      --xr-font-color3: var(
        --jp-content-font-color3,
        var(--pst-color-text-base, rgba(255, 255, 255, 0.38))
      );
      --xr-border-color: var(
        --jp-border-color2,
        hsl(from var(--pst-color-on-background, #111111) h s calc(l + 10))
      );
      --xr-disabled-color: var(
        --jp-layout-color3,
        hsl(from var(--pst-color-on-background, #111111) h s calc(l + 40))
      );
      --xr-background-color: var(
        --jp-layout-color0,
        var(--pst-color-on-background, #111111)
      );
      --xr-background-color-row-even: var(
        --jp-layout-color1,
        hsl(from var(--pst-color-on-background, #111111) h s calc(l + 5))
      );
      --xr-background-color-row-odd: var(
        --jp-layout-color2,
        hsl(from var(--pst-color-on-background, #111111) h s calc(l + 15))
      );
    }

    .xr-wrap {
      display: block !important;
      min-width: 300px;
      max-width: 700px;
      line-height: 1.6;
    }

    .xr-text-repr-fallback {
      /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
      display: none;
    }

    .xr-header {
      padding-top: 6px;
      padding-bottom: 6px;
      margin-bottom: 4px;
      border-bottom: solid 1px var(--xr-border-color);
    }

    .xr-header > div,
    .xr-header > ul {
      display: inline;
      margin-top: 0;
      margin-bottom: 0;
    }

    .xr-obj-type,
    .xr-obj-name,
    .xr-group-name {
      margin-left: 2px;
      margin-right: 10px;
    }

    .xr-group-name::before {
      content: "ðŸ“";
      padding-right: 0.3em;
    }

    .xr-group-name,
    .xr-obj-type {
      color: var(--xr-font-color2);
    }

    .xr-sections {
      padding-left: 0 !important;
      display: grid;
      grid-template-columns: 150px auto auto 1fr 0 20px 0 20px;
      margin-block-start: 0;
      margin-block-end: 0;
    }

    .xr-section-item {
      display: contents;
    }

    .xr-section-item input {
      display: inline-block;
      opacity: 0;
      height: 0;
      margin: 0;
    }

    .xr-section-item input + label {
      color: var(--xr-disabled-color);
      border: 2px solid transparent !important;
    }

    .xr-section-item input:enabled + label {
      cursor: pointer;
      color: var(--xr-font-color2);
    }

    .xr-section-item input:focus + label {
      border: 2px solid var(--xr-font-color0) !important;
    }

    .xr-section-item input:enabled + label:hover {
      color: var(--xr-font-color0);
    }

    .xr-section-summary {
      grid-column: 1;
      color: var(--xr-font-color2);
      font-weight: 500;
    }

    .xr-section-summary > span {
      display: inline-block;
      padding-left: 0.5em;
    }

    .xr-section-summary-in:disabled + label {
      color: var(--xr-font-color2);
    }

    .xr-section-summary-in + label:before {
      display: inline-block;
      content: "â–º";
      font-size: 11px;
      width: 15px;
      text-align: center;
    }

    .xr-section-summary-in:disabled + label:before {
      color: var(--xr-disabled-color);
    }

    .xr-section-summary-in:checked + label:before {
      content: "â–¼";
    }

    .xr-section-summary-in:checked + label > span {
      display: none;
    }

    .xr-section-summary,
    .xr-section-inline-details {
      padding-top: 4px;
    }

    .xr-section-inline-details {
      grid-column: 2 / -1;
    }

    .xr-section-details {
      display: none;
      grid-column: 1 / -1;
      margin-top: 4px;
      margin-bottom: 5px;
    }

    .xr-section-summary-in:checked ~ .xr-section-details {
      display: contents;
    }

    .xr-group-box {
      display: inline-grid;
      grid-template-columns: 0px 20px auto;
      width: 100%;
    }

    .xr-group-box-vline {
      grid-column-start: 1;
      border-right: 0.2em solid;
      border-color: var(--xr-border-color);
      width: 0px;
    }

    .xr-group-box-hline {
      grid-column-start: 2;
      grid-row-start: 1;
      height: 1em;
      width: 20px;
      border-bottom: 0.2em solid;
      border-color: var(--xr-border-color);
    }

    .xr-group-box-contents {
      grid-column-start: 3;
    }

    .xr-array-wrap {
      grid-column: 1 / -1;
      display: grid;
      grid-template-columns: 20px auto;
    }

    .xr-array-wrap > label {
      grid-column: 1;
      vertical-align: top;
    }

    .xr-preview {
      color: var(--xr-font-color3);
    }

    .xr-array-preview,
    .xr-array-data {
      padding: 0 5px !important;
      grid-column: 2;
    }

    .xr-array-data,
    .xr-array-in:checked ~ .xr-array-preview {
      display: none;
    }

    .xr-array-in:checked ~ .xr-array-data,
    .xr-array-preview {
      display: inline-block;
    }

    .xr-dim-list {
      display: inline-block !important;
      list-style: none;
      padding: 0 !important;
      margin: 0;
    }

    .xr-dim-list li {
      display: inline-block;
      padding: 0;
      margin: 0;
    }

    .xr-dim-list:before {
      content: "(";
    }

    .xr-dim-list:after {
      content: ")";
    }

    .xr-dim-list li:not(:last-child):after {
      content: ",";
      padding-right: 5px;
    }

    .xr-has-index {
      font-weight: bold;
    }

    .xr-var-list,
    .xr-var-item {
      display: contents;
    }

    .xr-var-item > div,
    .xr-var-item label,
    .xr-var-item > .xr-var-name span {
      background-color: var(--xr-background-color-row-even);
      border-color: var(--xr-background-color-row-odd);
      margin-bottom: 0;
      padding-top: 2px;
    }

    .xr-var-item > .xr-var-name:hover span {
      padding-right: 5px;
    }

    .xr-var-list > li:nth-child(odd) > div,
    .xr-var-list > li:nth-child(odd) > label,
    .xr-var-list > li:nth-child(odd) > .xr-var-name span {
      background-color: var(--xr-background-color-row-odd);
      border-color: var(--xr-background-color-row-even);
    }

    .xr-var-name {
      grid-column: 1;
    }

    .xr-var-dims {
      grid-column: 2;
    }

    .xr-var-dtype {
      grid-column: 3;
      text-align: right;
      color: var(--xr-font-color2);
    }

    .xr-var-preview {
      grid-column: 4;
    }

    .xr-index-preview {
      grid-column: 2 / 5;
      color: var(--xr-font-color2);
    }

    .xr-var-name,
    .xr-var-dims,
    .xr-var-dtype,
    .xr-preview,
    .xr-attrs dt {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      padding-right: 10px;
    }

    .xr-var-name:hover,
    .xr-var-dims:hover,
    .xr-var-dtype:hover,
    .xr-attrs dt:hover {
      overflow: visible;
      width: auto;
      z-index: 1;
    }

    .xr-var-attrs,
    .xr-var-data,
    .xr-index-data {
      display: none;
      border-top: 2px dotted var(--xr-background-color);
      padding-bottom: 20px !important;
      padding-top: 10px !important;
    }

    .xr-var-attrs-in + label,
    .xr-var-data-in + label,
    .xr-index-data-in + label {
      padding: 0 1px;
    }

    .xr-var-attrs-in:checked ~ .xr-var-attrs,
    .xr-var-data-in:checked ~ .xr-var-data,
    .xr-index-data-in:checked ~ .xr-index-data {
      display: block;
    }

    .xr-var-data > table {
      float: right;
    }

    .xr-var-data > pre,
    .xr-index-data > pre,
    .xr-var-data > table > tbody > tr {
      background-color: transparent !important;
    }

    .xr-var-name span,
    .xr-var-data,
    .xr-index-name div,
    .xr-index-data,
    .xr-attrs {
      padding-left: 25px !important;
    }

    .xr-attrs,
    .xr-var-attrs,
    .xr-var-data,
    .xr-index-data {
      grid-column: 1 / -1;
    }

    dl.xr-attrs {
      padding: 0;
      margin: 0;
      display: grid;
      grid-template-columns: 125px auto;
    }

    .xr-attrs dt,
    .xr-attrs dd {
      padding: 0;
      margin: 0;
      float: left;
      padding-right: 10px;
      width: auto;
    }

    .xr-attrs dt {
      font-weight: normal;
      grid-column: 1;
    }

    .xr-attrs dt:hover span {
      display: inline-block;
      background: var(--xr-background-color);
      padding-right: 10px;
    }

    .xr-attrs dd {
      grid-column: 2;
      white-space: pre-wrap;
      word-break: break-all;
    }

    .xr-icon-database,
    .xr-icon-file-text2,
    .xr-no-icon {
      display: inline-block;
      vertical-align: middle;
      width: 1em;
      height: 1.5em !important;
      stroke-width: 0;
      stroke: currentColor;
      fill: currentColor;
    }

    .xr-var-attrs-in:checked + label > .xr-icon-file-text2,
    .xr-var-data-in:checked + label > .xr-icon-database,
    .xr-index-data-in:checked + label > .xr-icon-database {
      color: var(--xr-font-color0);
      filter: drop-shadow(1px 1px 5px var(--xr-font-color2));
      stroke-width: 0.8px;
    }
    </style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt; Size: 11MB
    Dimensions:  (chain: 40, draw: 2000)
    Coordinates:
      * chain    (chain) int64 320B 0 1 2 3 4 5 6 7 8 ... 31 32 33 34 35 36 37 38 39
      * draw     (draw) int64 16kB 0 1 2 3 4 5 6 ... 1994 1995 1996 1997 1998 1999
    Data variables: (12/17)
        v0       (chain, draw) float64 640kB 3.168 3.236 3.236 ... 3.377 3.377 3.377
        t0       (chain, draw) float64 640kB 14.71 14.72 14.72 ... 20.48 20.48 20.48
        v1       (chain, draw) float64 640kB 3.249 3.36 3.36 ... 3.802 3.802 3.802
        t1       (chain, draw) float64 640kB 14.83 14.99 14.99 ... 25.81 25.81 25.81
        v2       (chain, draw) float64 640kB 3.703 3.929 3.929 ... 4.808 4.808 4.808
        t2       (chain, draw) float64 640kB 14.65 14.78 14.78 ... 18.61 18.61 18.61
        ...       ...
        t5       (chain, draw) float64 640kB 14.49 14.68 14.68 ... 23.13 23.13 23.13
        v6       (chain, draw) float64 640kB 4.431 4.335 4.335 ... 3.251 3.251 3.251
        t6       (chain, draw) float64 640kB 15.32 15.26 15.26 ... 9.125 9.125 9.125
        v7       (chain, draw) float64 640kB 4.134 4.104 4.104 ... 4.825 4.825 4.825
        t7       (chain, draw) float64 640kB 15.23 15.17 15.17 ... 15.78 15.78 15.78
        v8       (chain, draw) float64 640kB 4.284 4.361 4.361 ... 4.677 4.677 4.677
    Attributes:
        created_at:                 2026-01-28T07:48:45.647036+00:00
        arviz_version:              0.23.1
        inference_library:          emcee
        inference_library_version:  3.1.6</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-b543643a-9bcf-4a59-9504-55a8b81dc2e7' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-b543643a-9bcf-4a59-9504-55a8b81dc2e7' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>chain</span>: 40</li><li><span class='xr-has-index'>draw</span>: 2000</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-6e7f12d2-f106-46e3-876e-4b133c5702a1' class='xr-section-summary-in' type='checkbox'  checked><label for='section-6e7f12d2-f106-46e3-876e-4b133c5702a1' class='xr-section-summary' >Coordinates: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>chain</span></div><div class='xr-var-dims'>(chain)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0 1 2 3 4 5 6 ... 34 35 36 37 38 39</div><input id='attrs-d5b2e2a4-74b3-4806-a5fd-c1e3393e7c1d' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-d5b2e2a4-74b3-4806-a5fd-c1e3393e7c1d' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-9e46b37e-50cb-4ba1-8cf0-8712776c7292' class='xr-var-data-in' type='checkbox'><label for='data-9e46b37e-50cb-4ba1-8cf0-8712776c7292' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17,
           18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35,
           36, 37, 38, 39])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>draw</span></div><div class='xr-var-dims'>(draw)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0 1 2 3 4 ... 1996 1997 1998 1999</div><input id='attrs-da561d97-bfb9-4fb8-9b3f-987ed4868e41' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-da561d97-bfb9-4fb8-9b3f-987ed4868e41' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-06e5ab22-348c-43db-8442-cf16a66451cd' class='xr-var-data-in' type='checkbox'><label for='data-06e5ab22-348c-43db-8442-cf16a66451cd' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([   0,    1,    2, ..., 1997, 1998, 1999])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-7f1b8ddf-eb3a-4eb7-9262-fca6b86f97be' class='xr-section-summary-in' type='checkbox'  ><label for='section-7f1b8ddf-eb3a-4eb7-9262-fca6b86f97be' class='xr-section-summary' >Data variables: <span>(17)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>v0</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>3.168 3.236 3.236 ... 3.377 3.377</div><input id='attrs-203e0961-562c-436f-b305-bb803fb1ec44' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-203e0961-562c-436f-b305-bb803fb1ec44' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-49115ad0-dd57-4594-8a28-25a2c3428c9f' class='xr-var-data-in' type='checkbox'><label for='data-49115ad0-dd57-4594-8a28-25a2c3428c9f' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[3.16823882, 3.23637491, 3.23637491, ..., 3.39005764, 3.39005764,
            3.39005764],
           [3.51380559, 3.51380559, 3.53798526, ..., 3.39393223, 3.39393223,
            3.39393223],
           [3.51546859, 3.51546859, 3.39183383, ..., 3.39758337, 3.39758337,
            3.39758337],
           ...,
           [3.70176343, 3.70176343, 3.70176343, ..., 3.40498461, 3.40498461,
            3.40498461],
           [3.31646395, 3.27273462, 3.27273462, ..., 3.39428166, 3.39528799,
            3.39572874],
           [3.35417729, 3.35417729, 3.35417729, ..., 3.37738916, 3.37738916,
            3.37738916]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>t0</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>14.71 14.72 14.72 ... 20.48 20.48</div><input id='attrs-9fe9404e-3514-44b5-865d-82021783a607' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-9fe9404e-3514-44b5-865d-82021783a607' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-5dc62cdb-7541-470a-9e5b-549b9ae253a1' class='xr-var-data-in' type='checkbox'><label for='data-5dc62cdb-7541-470a-9e5b-549b9ae253a1' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[14.71235812, 14.72026108, 14.72026108, ..., 20.15330058,
            20.15330058, 20.15330058],
           [15.21749022, 15.21749022, 15.16599546, ..., 21.28992412,
            21.28992412, 21.28992412],
           [14.93093265, 14.93093265, 14.71291886, ..., 20.48610652,
            20.48610652, 20.48610652],
           ...,
           [14.80710219, 14.80710219, 14.80710219, ..., 19.62932691,
            19.62932691, 19.62932691],
           [15.64532735, 15.44156336, 15.44156336, ..., 21.6403109 ,
            24.04225586, 23.99420561],
           [14.71720635, 14.71720635, 14.71720635, ..., 20.47843424,
            20.47843424, 20.47843424]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>v1</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>3.249 3.36 3.36 ... 3.802 3.802</div><input id='attrs-72d6de70-9994-451c-ad75-959e28bdcc31' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-72d6de70-9994-451c-ad75-959e28bdcc31' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-f26028f7-df7c-4d75-8179-de0b8325400c' class='xr-var-data-in' type='checkbox'><label for='data-f26028f7-df7c-4d75-8179-de0b8325400c' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[3.24901228, 3.35988483, 3.35988483, ..., 3.78269234, 3.78269234,
            3.78269234],
           [3.18150866, 3.18150866, 3.40632039, ..., 3.80163748, 3.80163748,
            3.80163748],
           [3.91758382, 3.91758382, 3.76105819, ..., 3.81025822, 3.81025822,
            3.81025822],
           ...,
           [3.35567374, 3.35567374, 3.35567374, ..., 3.58682516, 3.58682516,
            3.58682516],
           [4.07695943, 3.93620828, 3.93620828, ..., 3.89465052, 3.96995041,
            3.96890136],
           [3.87774001, 3.87774001, 3.87774001, ..., 3.80159168, 3.80159168,
            3.80159168]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>t1</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>14.83 14.99 14.99 ... 25.81 25.81</div><input id='attrs-2a88183b-6496-4671-b32b-b9718322227a' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-2a88183b-6496-4671-b32b-b9718322227a' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-ec228841-e57e-4dfd-b178-8759d30738f3' class='xr-var-data-in' type='checkbox'><label for='data-ec228841-e57e-4dfd-b178-8759d30738f3' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[14.82915776, 14.98978163, 14.98978163, ..., 17.89249152,
            17.89249152, 17.89249152],
           [15.21662766, 15.21662766, 15.1520897 , ..., 17.29106265,
            17.29106265, 17.29106265],
           [14.79886694, 14.79886694, 15.02328879, ..., 22.74617067,
            22.74617067, 22.74617067],
           ...,
           [15.08613999, 15.08613999, 15.08613999, ...,  7.46270248,
             7.46270248,  7.46270248],
           [15.02212239, 15.14350157, 15.14350157, ..., 25.37032927,
            28.79394393, 28.25662867],
           [15.04047099, 15.04047099, 15.04047099, ..., 25.81265096,
            25.81265096, 25.81265096]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>v2</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>3.703 3.929 3.929 ... 4.808 4.808</div><input id='attrs-febae6ab-7300-48e9-b649-70796627c05d' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-febae6ab-7300-48e9-b649-70796627c05d' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-5664482a-ba6b-4cef-9587-7c1ae274fc87' class='xr-var-data-in' type='checkbox'><label for='data-5664482a-ba6b-4cef-9587-7c1ae274fc87' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[3.70256992, 3.92868813, 3.92868813, ..., 4.3235598 , 4.3235598 ,
            4.3235598 ],
           [3.9856111 , 3.9856111 , 4.03228762, ..., 4.07234106, 4.07234106,
            4.07234106],
           [3.8556995 , 3.8556995 , 3.87038703, ..., 4.30096952, 4.30096952,
            4.30096952],
           ...,
           [3.8004415 , 3.8004415 , 3.8004415 , ..., 3.88471865, 3.88471865,
            3.88471865],
           [3.98196574, 3.98441188, 3.98441188, ..., 4.44897651, 4.75648536,
            4.72450726],
           [4.04843326, 4.04843326, 4.04843326, ..., 4.80752011, 4.80752011,
            4.80752011]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>t2</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>14.65 14.78 14.78 ... 18.61 18.61</div><input id='attrs-0a6ba051-ac9a-41be-8528-cc074381fcb4' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-0a6ba051-ac9a-41be-8528-cc074381fcb4' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-d3e07583-f832-4971-a551-26ed50c5da23' class='xr-var-data-in' type='checkbox'><label for='data-d3e07583-f832-4971-a551-26ed50c5da23' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[14.65282913, 14.78013278, 14.78013278, ..., 29.53259212,
            29.53259212, 29.53259212],
           [15.24375452, 15.24375452, 15.12224471, ...,  7.53111899,
             7.53111899,  7.53111899],
           [15.23396022, 15.23396022, 15.28257882, ..., 14.0119226 ,
            14.0119226 , 14.0119226 ],
           ...,
           [14.75293969, 14.75293969, 14.75293969, ..., 11.36352928,
            11.36352928, 11.36352928],
           [15.23608366, 15.24427472, 15.24427472, ...,  6.14535299,
             5.84450419,  6.86036769],
           [15.03072778, 15.03072778, 15.03072778, ..., 18.60976747,
            18.60976747, 18.60976747]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>v3</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>4.195 4.157 4.157 ... 4.693 4.693</div><input id='attrs-55ac5e16-4047-48d1-ae54-ab9ea9e01e42' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-55ac5e16-4047-48d1-ae54-ab9ea9e01e42' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-6fe836dc-1309-4e15-aecd-0269e4ce8071' class='xr-var-data-in' type='checkbox'><label for='data-6fe836dc-1309-4e15-aecd-0269e4ce8071' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[4.19489946, 4.15745776, 4.15745776, ..., 4.47221281, 4.47221281,
            4.47221281],
           [4.12325215, 4.12325215, 4.19655582, ..., 4.56422701, 4.56422701,
            4.56422701],
           [4.67849791, 4.67849791, 4.59586966, ..., 4.99508225, 4.99508225,
            4.99508225],
           ...,
           [4.2900744 , 4.2900744 , 4.2900744 , ..., 4.53049265, 4.53049265,
            4.53049265],
           [4.43271874, 4.2234137 , 4.2234137 , ..., 4.81539001, 4.80522361,
            4.78637288],
           [4.51816805, 4.51816805, 4.51816805, ..., 4.69298844, 4.69298844,
            4.69298844]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>t3</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>15.05 15.08 15.08 ... 10.01 10.01</div><input id='attrs-a325a852-9320-4074-8762-983b9a0bb8da' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-a325a852-9320-4074-8762-983b9a0bb8da' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-e811e193-5250-4b47-a188-87998b35a86d' class='xr-var-data-in' type='checkbox'><label for='data-e811e193-5250-4b47-a188-87998b35a86d' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[15.04782773, 15.08198559, 15.08198559, ...,  8.56906546,
             8.56906546,  8.56906546],
           [15.20479825, 15.20479825, 15.14596469, ..., 11.65170057,
            11.65170057, 11.65170057],
           [15.39594684, 15.39594684, 15.24103019, ...,  5.75152589,
             5.75152589,  5.75152589],
           ...,
           [14.95327287, 14.95327287, 14.95327287, ...,  5.9440371 ,
             5.9440371 ,  5.9440371 ],
           [14.91734983, 14.83264557, 14.83264557, ..., 17.57555636,
            18.84861046, 18.27280934],
           [14.99271104, 14.99271104, 14.99271104, ..., 10.00867943,
            10.00867943, 10.00867943]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>v4</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>3.592 3.836 3.836 ... 3.907 3.907</div><input id='attrs-ab23b959-b631-4e89-96ff-24acb2b296c7' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-ab23b959-b631-4e89-96ff-24acb2b296c7' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-5e0b8f73-b7cc-4a6d-8090-91b05622f6fb' class='xr-var-data-in' type='checkbox'><label for='data-5e0b8f73-b7cc-4a6d-8090-91b05622f6fb' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[3.5918633 , 3.83607156, 3.83607156, ..., 4.05007981, 4.05007981,
            4.05007981],
           [4.24745208, 4.24745208, 4.30181315, ..., 4.26787039, 4.26787039,
            4.26787039],
           [4.49257314, 4.49257314, 4.40495979, ..., 4.44569536, 4.44569536,
            4.44569536],
           ...,
           [4.30891342, 4.30891342, 4.30891342, ..., 4.13746373, 4.13746373,
            4.13746373],
           [4.18560628, 4.09183002, 4.09183002, ..., 3.89281767, 3.89522623,
            3.93420598],
           [4.25682369, 4.25682369, 4.25682369, ..., 3.90686204, 3.90686204,
            3.90686204]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>t4</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>15.28 15.17 15.17 ... 19.11 19.11</div><input id='attrs-7f41b0a7-3c66-4ad8-a744-9c4196ec8afc' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-7f41b0a7-3c66-4ad8-a744-9c4196ec8afc' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-06133048-97c2-4621-a574-db72b84622b8' class='xr-var-data-in' type='checkbox'><label for='data-06133048-97c2-4621-a574-db72b84622b8' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[15.28129464, 15.1709943 , 15.1709943 , ..., 26.11444878,
            26.11444878, 26.11444878],
           [15.24094659, 15.24094659, 15.17584084, ..., 21.3974503 ,
            21.3974503 , 21.3974503 ],
           [14.66482403, 14.66482403, 14.6873594 , ..., 13.42064334,
            13.42064334, 13.42064334],
           ...,
           [14.89931027, 14.89931027, 14.89931027, ..., 25.89994662,
            25.89994662, 25.89994662],
           [15.49546403, 15.41013798, 15.41013798, ..., 18.92517138,
            19.9590086 , 20.4148828 ],
           [14.89398444, 14.89398444, 14.89398444, ..., 19.11352435,
            19.11352435, 19.11352435]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>v5</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>4.254 4.234 4.234 ... 4.809 4.809</div><input id='attrs-feb43a05-4fa2-4af4-9ae1-04af709483de' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-feb43a05-4fa2-4af4-9ae1-04af709483de' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-ff43a37d-2257-4114-8845-104c5521f5e8' class='xr-var-data-in' type='checkbox'><label for='data-ff43a37d-2257-4114-8845-104c5521f5e8' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[4.25447122, 4.23402978, 4.23402978, ..., 4.68571302, 4.68571302,
            4.68571302],
           [4.60285613, 4.60285613, 4.54805573, ..., 4.27115944, 4.27115944,
            4.27115944],
           [4.34239961, 4.34239961, 4.18443056, ..., 3.80172475, 3.80172475,
            3.80172475],
           ...,
           [4.0856875 , 4.0856875 , 4.0856875 , ..., 4.78086602, 4.78086602,
            4.78086602],
           [4.31120687, 4.33565248, 4.33565248, ..., 4.57954393, 4.4971877 ,
            4.5066945 ],
           [4.01114754, 4.01114754, 4.01114754, ..., 4.80913075, 4.80913075,
            4.80913075]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>t5</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>14.49 14.68 14.68 ... 23.13 23.13</div><input id='attrs-9a464302-288a-4200-ac6a-b2ec47637aa5' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-9a464302-288a-4200-ac6a-b2ec47637aa5' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-d784578c-e98c-40c9-af12-b95877e9bee1' class='xr-var-data-in' type='checkbox'><label for='data-d784578c-e98c-40c9-af12-b95877e9bee1' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[14.49135341, 14.67907735, 14.67907735, ..., 29.79139232,
            29.79139232, 29.79139232],
           [15.30879822, 15.30879822, 15.18641008, ..., 17.91339289,
            17.91339289, 17.91339289],
           [14.74669571, 14.74669571, 14.7458424 , ..., 14.96012381,
            14.96012381, 14.96012381],
           ...,
           [14.96780374, 14.96780374, 14.96780374, ..., 19.23502005,
            19.23502005, 19.23502005],
           [15.04283659, 15.01661614, 15.01661614, ..., 11.72510338,
            10.94035648, 11.57934385],
           [14.95254179, 14.95254179, 14.95254179, ..., 23.13338315,
            23.13338315, 23.13338315]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>v6</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>4.431 4.335 4.335 ... 3.251 3.251</div><input id='attrs-5d3819b6-7ca5-4702-9e68-d0aec9b422bf' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-5d3819b6-7ca5-4702-9e68-d0aec9b422bf' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-59b95430-b11b-4ba8-86e5-7ab63c4f255e' class='xr-var-data-in' type='checkbox'><label for='data-59b95430-b11b-4ba8-86e5-7ab63c4f255e' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[4.43072008, 4.33502552, 4.33502552, ..., 4.66598604, 4.66598604,
            4.66598604],
           [4.39164238, 4.39164238, 4.41450414, ..., 4.21220869, 4.21220869,
            4.21220869],
           [4.19547832, 4.19547832, 4.15772727, ..., 4.41179236, 4.41179236,
            4.41179236],
           ...,
           [4.45149896, 4.45149896, 4.45149896, ..., 3.96077922, 3.96077922,
            3.96077922],
           [3.9344087 , 4.0247334 , 4.0247334 , ..., 4.6571492 , 4.6033366 ,
            4.53672465],
           [4.22741751, 4.22741751, 4.22741751, ..., 3.25061496, 3.25061496,
            3.25061496]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>t6</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>15.32 15.26 15.26 ... 9.125 9.125</div><input id='attrs-4b592eb0-3e77-4703-bb7a-4efe951ed97e' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-4b592eb0-3e77-4703-bb7a-4efe951ed97e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-27ec8757-f71f-425b-b428-4a7dc2569ca2' class='xr-var-data-in' type='checkbox'><label for='data-27ec8757-f71f-425b-b428-4a7dc2569ca2' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[15.31831816, 15.25502392, 15.25502392, ..., 22.8443281 ,
            22.8443281 , 22.8443281 ],
           [14.82366736, 14.82366736, 14.73019061, ...,  7.4411747 ,
             7.4411747 ,  7.4411747 ],
           [14.91983958, 14.91983958, 14.8384564 , ...,  7.17601309,
             7.17601309,  7.17601309],
           ...,
           [15.23171528, 15.23171528, 15.23171528, ..., 28.64359931,
            28.64359931, 28.64359931],
           [14.82168512, 14.87847368, 14.87847368, ..., 19.66427724,
            20.00638563, 19.92756928],
           [14.67033646, 14.67033646, 14.67033646, ...,  9.12455804,
             9.12455804,  9.12455804]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>v7</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>4.134 4.104 4.104 ... 4.825 4.825</div><input id='attrs-2fe914d0-6a4e-4d19-a976-19cea837779d' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-2fe914d0-6a4e-4d19-a976-19cea837779d' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-f2e926d9-375b-4048-bea3-102c8b94faf6' class='xr-var-data-in' type='checkbox'><label for='data-f2e926d9-375b-4048-bea3-102c8b94faf6' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[4.13398961, 4.10411724, 4.10411724, ..., 3.4843882 , 3.4843882 ,
            3.4843882 ],
           [4.4032643 , 4.4032643 , 4.21630331, ..., 4.37239042, 4.37239042,
            4.37239042],
           [4.1889069 , 4.1889069 , 4.01408391, ..., 4.94379564, 4.94379564,
            4.94379564],
           ...,
           [4.06878258, 4.06878258, 4.06878258, ..., 4.94740173, 4.94740173,
            4.94740173],
           [4.20514672, 4.23210389, 4.23210389, ..., 3.88351945, 3.96546506,
            3.96532537],
           [4.13159942, 4.13159942, 4.13159942, ..., 4.82521657, 4.82521657,
            4.82521657]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>t7</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>15.23 15.17 15.17 ... 15.78 15.78</div><input id='attrs-45a45ed1-ff94-450c-9cb9-594dfc94b4ea' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-45a45ed1-ff94-450c-9cb9-594dfc94b4ea' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-4620642a-f0a6-467e-8d80-6d7536696d3e' class='xr-var-data-in' type='checkbox'><label for='data-4620642a-f0a6-467e-8d80-6d7536696d3e' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[15.22649565, 15.16957437, 15.16957437, ..., 12.90627353,
            12.90627353, 12.90627353],
           [14.34184078, 14.34184078, 14.47598123, ..., 21.7312287 ,
            21.7312287 , 21.7312287 ],
           [14.47058303, 14.47058303, 14.54816073, ..., 14.66925224,
            14.66925224, 14.66925224],
           ...,
           [15.27280225, 15.27280225, 15.27280225, ..., 16.43597684,
            16.43597684, 16.43597684],
           [14.88033396, 14.92205908, 14.92205908, ..., 22.91332568,
            23.20341062, 22.47517285],
           [15.06308061, 15.06308061, 15.06308061, ..., 15.78315173,
            15.78315173, 15.78315173]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>v8</span></div><div class='xr-var-dims'>(chain, draw)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>4.284 4.361 4.361 ... 4.677 4.677</div><input id='attrs-ec6b0897-bf15-47fe-9d2f-80c9ba10d8fb' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-ec6b0897-bf15-47fe-9d2f-80c9ba10d8fb' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-e96ae72b-91f0-4e8e-a098-e9197bbd7855' class='xr-var-data-in' type='checkbox'><label for='data-e96ae72b-91f0-4e8e-a098-e9197bbd7855' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[4.28417593, 4.36062259, 4.36062259, ..., 4.57159724, 4.57159724,
            4.57159724],
           [4.46387865, 4.46387865, 4.49341151, ..., 4.45162818, 4.45162818,
            4.45162818],
           [4.31668296, 4.31668296, 4.45305792, ..., 4.45968138, 4.45968138,
            4.45968138],
           ...,
           [4.55044997, 4.55044997, 4.55044997, ..., 4.48810698, 4.48810698,
            4.48810698],
           [4.60937652, 4.57232696, 4.57232696, ..., 4.71218878, 4.72172384,
            4.73057195],
           [4.86414945, 4.86414945, 4.86414945, ..., 4.67685294, 4.67685294,
            4.67685294]])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-8e10fabd-7aaf-4566-9791-2c71c5aa69e1' class='xr-section-summary-in' type='checkbox'  checked><label for='section-8e10fabd-7aaf-4566-9791-2c71c5aa69e1' class='xr-section-summary' >Attributes: <span>(4)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>created_at :</span></dt><dd>2026-01-28T07:48:45.647036+00:00</dd><dt><span>arviz_version :</span></dt><dd>0.23.1</dd><dt><span>inference_library :</span></dt><dd>emcee</dd><dt><span>inference_library_version :</span></dt><dd>3.1.6</dd></dl></div></li></ul></div></div>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 1468-1503

.. code-block:: Python


    # plot the model and d_pred for starting model
    axes = plot_model_and_data(model=init_model, label_model="starting model", color_model="black",
                               forward_func=forward_sw_interp, periods=field_d_periods_logspace, 
                               label_d_pred="d_pred from starting model", color_d_pred="black")

    # plot the model and d_pred for true model
    plot_model_and_data(model=ref_good_model, label_model="reference good model", color_model="red",
                        forward_func=forward_sw_interp, periods=field_d_periods_logspace, 
                        label_d_pred="d_pred from reference good model", color_d_pred="red", axes=axes)

    # plot the model and d_pred for inverted model, and d_obs
    plot_model_and_data(model=inv_result_sw_field.model, 
                        label_model="inverted model from field data", color_model="green",
                        forward_func=forward_sw_interp, periods=field_d_periods_logspace,
                        label_d_pred="d_pred from inverted model", color_d_pred="green", axes=axes)

    # plot randomly selected samples and data predictions from samples
    flat_samples = sampler.get_chain(discard=1000, thin=300, flat=True)
    rand_indices = np.random.randint(len(flat_samples), size=100)
    for idx in rand_indices:
        sample = flat_samples[idx]
        label_model = "sample models" if idx == 0 else None
        label_d_pred = "d_pred from samples" if idx == 0 else None
        plot_model_and_data(model=sample, label_model=label_model, color_model="gray",
                            forward_func=forward_sw_interp, periods=field_d_periods_logspace,
                            label_d_pred=label_d_pred, color_d_pred="gray", axes=axes, light_thin=True)

    # plot d_obs
    plot_data(field_d_obs, field_d_periods, ax=axes[1], scatter=True, color="orange", s=8, label="d_obs")

    axes[0].set_ylim(100, 0)
    axes[0].legend(loc="lower center", bbox_to_anchor=(0.5, -0.4))
    axes[1].legend(loc="lower center", bbox_to_anchor=(0.5, -0.46));




.. image-sg:: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_015.png
   :alt: model, data
   :srcset: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_015.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    <matplotlib.legend.Legend object at 0x7f972b26fd50>



.. GENERATED FROM PYTHON SOURCE LINES 1508-1523

**More steps**

Similar to our earlier fixed-dimensional sampling run on the synthetic
data, we are not sampling enough due to time limit.

On a seperate experiment, we ran 200_000 steps and produced the
following samples plot.

.. figure::
   https://raw.githubusercontent.com/inlab-geo/cofi-examples/main/tutorials/rayleigh_wave_phase_velocity/illustrations/emcee_200_000_iterations_field.png?raw=true
   :alt: Fixed-dimensional sampling results on field data with 200_000
   steps

   Fixed-dimensional sampling results on field data with 200_000 steps


.. GENERATED FROM PYTHON SOURCE LINES 1526-1529

Trans-dimensional sampling
~~~~~~~~~~~~~~~~~~~~~~~~~~


.. GENERATED FROM PYTHON SOURCE LINES 1529-1538

.. code-block:: Python


    def forward_interp_for_bayesbay(state):
        vs = state["voronoi"]["vs"]
        voronoi_sites = state["voronoi"]["discretization"]
        depths = (voronoi_sites[:-1] + voronoi_sites[1:]) / 2
        thicknesses = depths - np.insert(depths[:-1], 0, 0)
        model = form_layercake_model(thicknesses, vs)
        return forward_sw_interp(model, field_d_periods)








.. GENERATED FROM PYTHON SOURCE LINES 1540-1545

.. code-block:: Python


    targets = [bayesbay.likelihood.Target("rayleigh", field_d_obs, covariance_mat_inv=1/noise_level**2)]
    fwd_funcs = [forward_interp_for_bayesbay]
    my_log_likelihood = bayesbay.likelihood.LogLikelihood(targets, fwd_funcs) 








.. GENERATED FROM PYTHON SOURCE LINES 1547-1570

.. code-block:: Python


    param_vs = bayesbay.prior.UniformPrior(
        name="vs", 
        vmin=[2.7, 3.2, 3.75], 
        vmax=[4, 4.75, 5], 
        position=[0, 40, 80], 
        perturb_std=0.15
    )

    def param_vs_initialize(param, positions): 
        vmin, vmax = param.get_vmin_vmax(positions)
        sorted_vals = np.sort(np.random.uniform(vmin, vmax, positions.size))
        for i in range (len(sorted_vals)):
            val = sorted_vals[i]
            vmin_i = vmin if np.isscalar(vmin) else vmin[i]
            vmax_i = vmax if np.isscalar(vmax) else vmax[i]
            if val < vmin_i or val > vmax_i:
                if val > vmax_i: sorted_vals[i] = vmax_i
                if val < vmin_i: sorted_vals[i] = vmin_i
        return sorted_vals

    param_vs.set_custom_initialize(param_vs_initialize)








.. GENERATED FROM PYTHON SOURCE LINES 1572-1587

.. code-block:: Python


    parameterization = bayesbay.parameterization.Parameterization(
        bayesbay.discretization.Voronoi1D(
            name="voronoi", 
            vmin=0, 
            vmax=150, 
            perturb_std=10, 
            n_dimensions=None, 
            n_dimensions_min=4, 
            n_dimensions_max=20, 
            parameters=[param_vs], 
        )
    )
    my_perturbation_funcs = parameterization.perturbation_funcs








.. GENERATED FROM PYTHON SOURCE LINES 1589-1595

.. code-block:: Python


    n_chains=12
    walkers_start = []
    for i in range(n_chains):
        walkers_start.append(parameterization.initialize())








.. GENERATED FROM PYTHON SOURCE LINES 1600-1602

**Define ``InversionOptions``**


.. GENERATED FROM PYTHON SOURCE LINES 1602-1616

.. code-block:: Python


    inv_options_field_trans_d_sampling = cofi.InversionOptions()
    inv_options_field_trans_d_sampling.set_tool("bayesbay")
    inv_options_field_trans_d_sampling.set_params(
        walkers_starting_states=walkers_start,
        perturbation_funcs=my_perturbation_funcs,
        log_like_ratio_func=my_log_likelihood,
        n_chains=n_chains, 
        n_iterations=3_000, 
        burnin_iterations=1_000,
        verbose=False, 
        save_every=200, 
    )








.. GENERATED FROM PYTHON SOURCE LINES 1621-1623

**Define ``Inversion`` and run**


.. GENERATED FROM PYTHON SOURCE LINES 1623-1628

.. code-block:: Python


    inversion_field_trans_d_sampler = cofi.Inversion(sw_field_problem, 
                                                     inv_options_field_trans_d_sampling)
    inv_result_field_trans_d_sampler = inversion_field_trans_d_sampler.run()








.. GENERATED FROM PYTHON SOURCE LINES 1630-1637

.. code-block:: Python


    inverted_models = inv_result_field_trans_d_sampler.models
    samples = []
    for v, vs in zip(inverted_models["voronoi.discretization"], inverted_models["voronoi.vs"]):
        sample = form_voronoi_model(v, vs)
        samples.append(voronoi_to_layercake(sample))








.. GENERATED FROM PYTHON SOURCE LINES 1639-1673

.. code-block:: Python


    # plot the model and d_pred for starting model
    axes = plot_model_and_data(model=init_model, label_model="starting model", color_model="black",
                               forward_func=forward_sw_interp, periods=field_d_periods_logspace, 
                               label_d_pred="d_pred from starting model", color_d_pred="black")

    # plot the model and d_pred for true model
    plot_model_and_data(model=ref_good_model, label_model="reference good model", color_model="red",
                        forward_func=forward_sw_interp, periods=field_d_periods_logspace, 
                        label_d_pred="d_pred from reference good model", color_d_pred="red", axes=axes)

    # plot the model and d_pred for inverted model, and d_obs
    plot_model_and_data(model=inv_result_sw_field.model, 
                        label_model="inverted model from field data", color_model="green",
                        forward_func=forward_sw_interp, periods=field_d_periods_logspace,
                        label_d_pred="d_pred from inverted model", color_d_pred="green", axes=axes)

    # plot randomly selected samples and data predictions from samples
    flat_samples = sampler.get_chain(discard=1000, thin=300, flat=True)
    rand_indices = np.random.randint(len(flat_samples), size=100)
    for i, sample in enumerate(samples):
        label_model = "sample models" if i == 0 else None
        label_d_pred = "d_pred from samples" if i == 0 else None
        plot_model_and_data(model=sample, label_model=label_model, color_model="gray",
                            forward_func=forward_sw_interp, periods=field_d_periods_logspace,
                            label_d_pred=label_d_pred, color_d_pred="gray", axes=axes, light_thin=True)

    # plot d_obs
    plot_data(field_d_obs, field_d_periods, ax=axes[1], scatter=True, color="orange", s=8, label="d_obs")

    axes[0].set_ylim(100, 0)
    axes[0].legend(loc="lower center", bbox_to_anchor=(0.5, -0.4))
    axes[1].legend(loc="lower center", bbox_to_anchor=(0.5, -0.46));




.. image-sg:: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_016.png
   :alt: model, data
   :srcset: /tutorials/generated/images/sphx_glr_1D_rayleigh_wave_phase_velocity_inversion_016.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    <matplotlib.legend.Legend object at 0x7f972aba4b10>



.. GENERATED FROM PYTHON SOURCE LINES 1678-1683

--------------

Watermark
---------


.. GENERATED FROM PYTHON SOURCE LINES 1683-1689

.. code-block:: Python


    watermark_list = ["cofi", "numpy", "matplotlib", "scipy", "emcee", "bayesbay"]
    for pkg in watermark_list:
        pkg_var = __import__(pkg)
        print(pkg, getattr(pkg_var, "__version__"))





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    cofi 0.2.10
    numpy 1.26.4
    matplotlib 3.10.8
    scipy 1.14.1
    emcee 3.1.6
    bayesbay 0.3.7




.. GENERATED FROM PYTHON SOURCE LINES 1690-1690

sphinx_gallery_thumbnail_number = -1


.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 53.967 seconds)


.. _sphx_glr_download_tutorials_generated_1D_rayleigh_wave_phase_velocity_inversion.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: 1D_rayleigh_wave_phase_velocity_inversion.ipynb <1D_rayleigh_wave_phase_velocity_inversion.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: 1D_rayleigh_wave_phase_velocity_inversion.py <1D_rayleigh_wave_phase_velocity_inversion.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: 1D_rayleigh_wave_phase_velocity_inversion.zip <1D_rayleigh_wave_phase_velocity_inversion.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
